<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>‚ú® Vibe Check ‚Äî Know Before You Build</title>
  <style>
    :root {
      --bg: #07070f;
      --card-bg: #0d0d1a;
      --card-border: #1a1a30;
      --purple: #8b5cf6;
      --pink: #ec4899;
      --blue: #3b82f6;
      --cyan: #06b6d4;
      --green: #10b981;
      --yellow: #f59e0b;
      --red: #ef4444;
      --text: #e2e8f0;
      --muted: #64748b;
      --subtle: #1e1e3a;
      --radius: 14px;
      --grad: linear-gradient(135deg, var(--purple), var(--pink));
    }

    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      background: var(--bg);
      color: var(--text);
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      min-height: 100vh;
      overflow-x: hidden;
    }

    body::before {
      content: '';
      position: fixed;
      top: -20%;
      left: 50%;
      transform: translateX(-50%);
      width: 70vw;
      height: 50vh;
      background: radial-gradient(ellipse, rgba(139,92,246,0.1) 0%, transparent 70%);
      pointer-events: none;
      z-index: 0;
    }

    /* ‚îÄ‚îÄ HEADER ‚îÄ‚îÄ */
    header {
      position: relative;
      z-index: 1;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 20px 32px;
      border-bottom: 1px solid var(--card-border);
    }
    .logo { display: flex; align-items: center; gap: 10px; }
    .logo-text {
      font-size: 18px;
      font-weight: 800;
      background: var(--grad);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    .logo-badge {
      font-size: 11px;
      background: var(--subtle);
      color: var(--purple);
      border: 1px solid rgba(139,92,246,0.4);
      border-radius: 6px;
      padding: 2px 8px;
      font-weight: 600;
    }

    /* ‚îÄ‚îÄ MAIN ‚îÄ‚îÄ */
    main {
      position: relative;
      z-index: 1;
      max-width: 1080px;
      margin: 0 auto;
      padding: 52px 24px 100px;
    }

    /* ‚îÄ‚îÄ HERO ‚îÄ‚îÄ */
    .hero { text-align: center; margin-bottom: 44px; }
    .hero h1 {
      font-size: clamp(36px, 5vw, 56px);
      font-weight: 800;
      line-height: 1.12;
      margin-bottom: 14px;
    }
    .hero h1 span {
      background: var(--grad);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    .hero p { color: var(--muted); font-size: 17px; }

    /* ‚îÄ‚îÄ INPUT CARD ‚îÄ‚îÄ */
    .input-card {
      background: var(--card-bg);
      border: 1px solid var(--card-border);
      border-radius: 20px;
      padding: 24px;
      box-shadow: 0 24px 64px rgba(0,0,0,0.3);
      margin-top: 36px;
    }
    .input-card textarea {
      width: 100%;
      background: var(--subtle);
      border: 1px solid var(--card-border);
      border-radius: 12px;
      padding: 16px 18px;
      color: var(--text);
      font-size: 15px;
      font-family: inherit;
      resize: none;
      height: 110px;
      outline: none;
      transition: border-color 0.2s;
      line-height: 1.65;
    }
    .input-card textarea:focus { border-color: var(--purple); }
    .input-card textarea::placeholder { color: var(--muted); }

    /* ‚îÄ‚îÄ SKILL SLIDER ‚îÄ‚îÄ */
    .skill-section { margin: 20px 0 4px; }
    .skill-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 14px;
    }
    .skill-header-label {
      font-size: 12px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--muted);
    }
    .skill-current {
      font-size: 13px;
      font-weight: 700;
      color: var(--purple);
      background: rgba(139,92,246,0.12);
      border: 1px solid rgba(139,92,246,0.3);
      border-radius: 100px;
      padding: 3px 12px;
      transition: all 0.2s;
    }
    .slider-wrap { position: relative; padding: 0 2px; }
    input[type="range"] {
      -webkit-appearance: none;
      width: 100%;
      height: 4px;
      background: var(--subtle);
      border-radius: 2px;
      outline: none;
      cursor: pointer;
    }
    input[type="range"]::-webkit-slider-runnable-track {
      height: 4px;
      border-radius: 2px;
    }
    input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 22px;
      height: 22px;
      border-radius: 50%;
      background: white;
      box-shadow: 0 2px 10px rgba(139,92,246,0.5);
      cursor: pointer;
      margin-top: -9px;
      border: 2px solid var(--purple);
      transition: transform 0.15s, box-shadow 0.15s;
    }
    input[type="range"]::-webkit-slider-thumb:hover {
      transform: scale(1.15);
      box-shadow: 0 4px 16px rgba(139,92,246,0.6);
    }
    .slider-labels {
      display: flex;
      justify-content: space-between;
      margin-top: 10px;
    }
    .slider-labels span {
      font-size: 12px;
      color: var(--muted);
      text-align: center;
      flex: 1;
      transition: color 0.2s;
    }
    .slider-labels span.active { color: var(--purple); font-weight: 600; }

    /* ‚îÄ‚îÄ ANALYZE BUTTON ‚îÄ‚îÄ */
    .input-footer { display: flex; justify-content: flex-end; margin-top: 20px; }
    .analyze-btn {
      background: var(--grad);
      color: white;
      border: none;
      border-radius: 12px;
      padding: 13px 30px;
      font-size: 15px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .analyze-btn:hover { opacity: 0.88; transform: translateY(-1px); box-shadow: 0 8px 28px rgba(139,92,246,0.45); }
    .analyze-btn:disabled { opacity: 0.45; cursor: not-allowed; transform: none; box-shadow: none; }

    /* ‚îÄ‚îÄ PROGRESS ‚îÄ‚îÄ */
    #progress-section { margin-bottom: 36px; display: none; }
    .progress-header { text-align: center; margin-bottom: 20px; }
    .progress-header p { color: var(--muted); font-size: 14px; }
    .progress-steps { display: flex; justify-content: center; gap: 10px; flex-wrap: wrap; }
    .progress-step {
      display: flex; align-items: center; gap: 7px;
      background: var(--card-bg); border: 1px solid var(--card-border);
      border-radius: 100px; padding: 7px 14px;
      font-size: 12px; font-weight: 500; color: var(--muted);
      transition: all 0.3s;
    }
    .progress-step.active { border-color: var(--purple); color: var(--purple); background: rgba(139,92,246,0.08); }
    .progress-step.done  { border-color: var(--green);  color: var(--green);  background: rgba(16,185,129,0.08); }
    .step-dot { width: 7px; height: 7px; border-radius: 50%; background: currentColor; }
    .progress-step.active .step-dot { animation: pulse 1s infinite; }
    @keyframes pulse { 0%,100%{opacity:1}50%{opacity:0.35} }

    /* ‚îÄ‚îÄ RESULTS ‚îÄ‚îÄ */
    #results-section { display: none; }
    .results-header { text-align: center; margin-bottom: 28px; }
    .results-header h2 { font-size: 22px; font-weight: 700; margin-bottom: 4px; }
    .results-header p { color: var(--muted); font-size: 14px; }
    .results-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px; }

    /* ‚îÄ‚îÄ CARDS ‚îÄ‚îÄ */
    .result-card {
      background: var(--card-bg);
      border: 1px solid var(--card-border);
      border-radius: var(--radius);
      overflow: hidden;
      opacity: 0;
      transform: translateY(16px);
      transition: opacity 0.45s, transform 0.45s, border-color 0.2s;
    }
    .result-card.visible { opacity: 1; transform: translateY(0); }
    .result-card.full { grid-column: 1 / -1; }
    .result-card.vibe-hero {
      grid-column: 1 / -1;
      border-color: rgba(139,92,246,0.3);
      background: linear-gradient(135deg, rgba(139,92,246,0.07), rgba(236,72,153,0.05));
    }
    .card-header {
      display: flex; align-items: center; gap: 10px;
      padding: 16px 20px; border-bottom: 1px solid var(--card-border);
    }
    .card-icon {
      width: 34px; height: 34px; border-radius: 9px;
      display: flex; align-items: center; justify-content: center;
      font-size: 15px; flex-shrink: 0;
    }
    .icon-purple { background: rgba(139,92,246,0.15); }
    .icon-pink   { background: rgba(236,72,153,0.15); }
    .icon-blue   { background: rgba(59,130,246,0.15); }
    .icon-green  { background: rgba(16,185,129,0.15); }
    .icon-yellow { background: rgba(245,158,11,0.15); }
    .icon-cyan   { background: rgba(6,182,212,0.15); }
    .icon-red    { background: rgba(239,68,68,0.15); }
    .card-title { font-size: 14px; font-weight: 700; }
    .card-subtitle { font-size: 12px; color: var(--muted); margin-top: 1px; }
    .card-body { padding: 20px; }

    .skeleton {
      background: linear-gradient(90deg, var(--subtle) 25%, #1a1a35 50%, var(--subtle) 75%);
      background-size: 200% 100%;
      animation: shimmer 1.5s infinite;
      border-radius: 8px;
    }
    @keyframes shimmer { 0%{background-position:200% 0}100%{background-position:-200% 0} }

    /* ‚îÄ‚îÄ VIBE SCORE HERO ‚îÄ‚îÄ */
    .vibe-score-layout {
      display: flex;
      gap: 28px;
      align-items: flex-start;
    }
    .vibe-grade-block {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 6px;
      flex-shrink: 0;
    }
    .vibe-grade {
      font-size: 52px;
      font-weight: 900;
      background: var(--grad);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      line-height: 1;
    }
    .vibe-score-num {
      font-size: 13px;
      color: var(--muted);
      font-weight: 600;
    }
    .vibe-score-ring { flex-shrink: 0; }
    .vibe-score-ring svg { transform: rotate(-90deg); }
    .vibe-content { flex: 1; min-width: 0; }
    .vibe-content h3 { font-size: 18px; font-weight: 700; margin-bottom: 8px; }
    .vibe-content p { font-size: 14px; color: var(--muted); line-height: 1.65; }
    .vibe-pills { display: flex; gap: 7px; flex-wrap: wrap; margin-top: 14px; }

    /* ‚îÄ‚îÄ PILLS ‚îÄ‚îÄ */
    .pill { display: inline-flex; align-items: center; gap: 4px; border-radius: 100px; padding: 4px 10px; font-size: 12px; font-weight: 600; white-space: nowrap; }
    .pill-purple { background: rgba(139,92,246,0.15); color: var(--purple); }
    .pill-green  { background: rgba(16,185,129,0.15); color: var(--green); }
    .pill-red    { background: rgba(239,68,68,0.15);  color: var(--red); }
    .pill-yellow { background: rgba(245,158,11,0.15); color: var(--yellow); }
    .pill-blue   { background: rgba(59,130,246,0.15); color: var(--blue); }
    .pill-cyan   { background: rgba(6,182,212,0.15);  color: var(--cyan); }
    .pill-muted  { background: var(--subtle); color: var(--muted); }

    /* ‚îÄ‚îÄ SATURATION METER ‚îÄ‚îÄ */
    .sat-block { margin-bottom: 16px; }
    .sat-label { display: flex; justify-content: space-between; font-size: 12px; color: var(--muted); margin-bottom: 6px; }
    .sat-track { height: 8px; background: var(--subtle); border-radius: 100px; overflow: hidden; }
    .sat-fill  { height: 100%; border-radius: 100px; transition: width 0.8s ease; }

    .exists-badge {
      display: inline-flex; align-items: center; gap: 8px;
      padding: 9px 14px; border-radius: 10px;
      font-size: 14px; font-weight: 700;
      margin-bottom: 14px;
    }
    .exists-dot { width: 9px; height: 9px; border-radius: 50%; flex-shrink: 0; }

    /* ‚îÄ‚îÄ COMPETITOR GRID ‚îÄ‚îÄ */
    .competitor-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(240px, 1fr)); gap: 12px; }
    .comp-card {
      background: var(--subtle);
      border: 1px solid var(--card-border);
      border-radius: 12px;
      padding: 14px;
    }
    .comp-name { font-size: 14px; font-weight: 700; margin-bottom: 5px; }
    .comp-name a { color: var(--text); text-decoration: none; }
    .comp-name a:hover { color: var(--purple); }
    .comp-desc { font-size: 12px; color: var(--muted); line-height: 1.55; margin-bottom: 8px; }
    .comp-sw { display: flex; flex-direction: column; gap: 4px; }
    .comp-sw-item { font-size: 12px; color: var(--muted); display: flex; gap: 5px; }

    /* ‚îÄ‚îÄ TWO-COL ‚îÄ‚îÄ */
    .two-col { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 14px; }
    .data-block { background: var(--subtle); border-radius: 10px; padding: 12px; }
    .data-block small { display: block; font-size: 11px; color: var(--muted); font-weight: 600; text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 4px; }
    .data-block span, .data-block strong { font-size: 13px; }

    /* ‚îÄ‚îÄ AUDIENCE ROWS ‚îÄ‚îÄ */
    .audience-row {
      display: flex; align-items: center; gap: 10px;
      padding: 10px 12px;
      background: var(--subtle);
      border-radius: 10px;
      margin-bottom: 8px;
    }
    .audience-row:last-child { margin-bottom: 0; }
    .audience-row-main { flex: 1; }
    .audience-row-main strong { display: block; font-size: 13px; margin-bottom: 2px; }
    .audience-row-main span { font-size: 12px; color: var(--muted); }

    /* ‚îÄ‚îÄ REVENUE ROWS ‚îÄ‚îÄ */
    .rev-row {
      display: flex; align-items: center; justify-content: space-between; gap: 8px;
      padding: 10px 12px;
      background: var(--subtle);
      border-radius: 10px;
      margin-bottom: 7px;
    }
    .rev-row:last-child { margin-bottom: 0; }
    .rev-model { font-size: 13px; font-weight: 700; }
    .rev-desc  { font-size: 12px; color: var(--muted); margin-top: 2px; }
    .rev-badge { flex-shrink: 0; }

    /* ‚îÄ‚îÄ DIFF BAR ‚îÄ‚îÄ */
    .diff-display { display: flex; align-items: center; gap: 20px; margin-bottom: 18px; }
    .diff-score-ring { position: relative; width: 70px; height: 70px; flex-shrink: 0; }
    .diff-score-ring svg { transform: rotate(-90deg); }
    .diff-ring-text { position: absolute; inset: 0; display: flex; flex-direction: column; align-items: center; justify-content: center; }
    .diff-ring-text strong { font-size: 18px; font-weight: 800; }
    .diff-ring-text span { font-size: 10px; color: var(--muted); }

    /* ‚îÄ‚îÄ TIME GRID ‚îÄ‚îÄ */
    .time-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-bottom: 14px; }
    .time-cell { background: var(--subtle); border-radius: 9px; padding: 10px; text-align: center; }
    .time-cell small { display: block; font-size: 11px; color: var(--muted); margin-bottom: 3px; }
    .time-cell strong { font-size: 12px; }

    /* ‚îÄ‚îÄ SECTION LABEL ‚îÄ‚îÄ */
    .sec-label {
      font-size: 11px; font-weight: 700; text-transform: uppercase;
      letter-spacing: 0.1em; color: var(--muted);
      margin: 16px 0 10px;
      display: flex; align-items: center; gap: 8px;
    }
    .sec-label::after { content: ''; flex: 1; height: 1px; background: var(--card-border); }

    /* ‚îÄ‚îÄ ITEM ROWS ‚îÄ‚îÄ */
    .item-row { display: flex; gap: 8px; padding: 10px 12px; background: var(--subtle); border-radius: 10px; margin-bottom: 7px; align-items: flex-start; }
    .item-row:last-child { margin-bottom: 0; }
    .item-icon { flex-shrink: 0; font-size: 14px; margin-top: 1px; }
    .item-body strong { display: block; font-size: 13px; margin-bottom: 2px; }
    .item-body span { font-size: 12px; color: var(--muted); }

    /* ‚îÄ‚îÄ PLATFORM ‚îÄ‚îÄ */
    .platform-hero {
      display: flex; align-items: center; gap: 14px;
      padding: 14px; border-radius: 12px;
      background: rgba(16,185,129,0.08);
      border: 1px solid rgba(16,185,129,0.2);
      margin-bottom: 14px;
    }
    .platform-emoji { font-size: 28px; }
    .platform-name { font-size: 16px; font-weight: 700; color: var(--green); }
    .platform-reason { font-size: 12px; color: var(--muted); margin-top: 3px; line-height: 1.5; }
    .platform-list { display: flex; flex-direction: column; gap: 7px; }
    .plat-row {
      display: flex; align-items: center; gap: 10px;
      padding: 9px 12px; background: var(--subtle); border-radius: 9px;
      border-left: 3px solid transparent;
    }
    .plat-row.high { border-left-color: var(--green); }
    .plat-row.med  { border-left-color: var(--yellow); }
    .plat-row.low  { border-left-color: var(--red); }
    .plat-row-name { font-size: 13px; font-weight: 600; flex: 1; }
    .plat-row-meta { font-size: 11px; color: var(--muted); }

    /* ‚îÄ‚îÄ REDDIT QUOTES ‚îÄ‚îÄ */
    .reddit-group { margin-bottom: 20px; }
    .reddit-group:last-child { margin-bottom: 0; }
    .reddit-group-label { font-size: 11px; font-weight: 700; color: var(--muted); text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 10px; }
    .reddit-quote {
      display: flex; align-items: flex-start; gap: 10px;
      padding: 12px 14px;
      background: var(--subtle);
      border-radius: 10px;
      border-left: 3px solid rgba(139,92,246,0.4);
      margin-bottom: 8px;
      text-decoration: none;
      color: var(--text);
      transition: background 0.2s, border-color 0.2s;
    }
    .reddit-quote:hover { background: #1a1a38; border-left-color: var(--purple); }
    .reddit-quote-text { font-size: 13px; line-height: 1.5; flex: 1; }
    .reddit-quote-src { font-size: 11px; color: var(--muted); margin-top: 5px; }
    .reddit-arrow { font-size: 14px; color: var(--muted); flex-shrink: 0; padding-top: 1px; transition: color 0.2s; }
    .reddit-quote:hover .reddit-arrow { color: var(--purple); }

    /* ‚îÄ‚îÄ HOW TO WIN ‚îÄ‚îÄ */
    .win-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 10px; }
    .win-card {
      background: var(--subtle);
      border: 1px solid var(--card-border);
      border-radius: 12px;
      padding: 14px;
    }
    .win-card-header { display: flex; align-items: flex-start; gap: 8px; margin-bottom: 6px; }
    .win-card-title { font-size: 13px; font-weight: 700; flex: 1; line-height: 1.4; }
    .win-card-reason { font-size: 12px; color: var(--muted); line-height: 1.55; }
    .win-badges { display: flex; gap: 5px; margin-top: 8px; flex-wrap: wrap; }

    /* ‚îÄ‚îÄ SUMMARY BOX ‚îÄ‚îÄ */
    .summary-box {
      background: rgba(139,92,246,0.07);
      border: 1px solid rgba(139,92,246,0.18);
      border-radius: 10px;
      padding: 12px 14px;
      font-size: 13px;
      line-height: 1.65;
      color: var(--text);
      margin-top: 14px;
    }

    /* ‚îÄ‚îÄ NEW ANALYSIS ‚îÄ‚îÄ */
    .new-analysis-wrap { text-align: center; margin-top: 44px; }

    /* ‚îÄ‚îÄ VERSION BADGE ‚îÄ‚îÄ */
    .version-badge {
      position: fixed;
      bottom: 16px;
      right: 16px;
      z-index: 100;
      background: var(--card-bg);
      border: 1px solid var(--card-border);
      border-radius: 100px;
      padding: 5px 12px;
      font-size: 11px;
      color: var(--muted);
      cursor: pointer;
      transition: all 0.2s;
      font-weight: 600;
    }
    .version-badge:hover { border-color: var(--purple); color: var(--text); }

    /* ‚îÄ‚îÄ CHANGELOG MODAL ‚îÄ‚îÄ */
    .changelog-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.7); backdrop-filter: blur(6px); z-index: 999; display: flex; align-items: flex-end; justify-content: flex-end; padding: 20px; }
    .changelog-overlay.hidden { display: none; }
    .changelog-modal {
      background: var(--card-bg);
      border: 1px solid var(--card-border);
      border-radius: 16px;
      padding: 22px;
      width: 320px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.5);
    }
    .changelog-modal h3 { font-size: 15px; font-weight: 700; margin-bottom: 16px; display: flex; align-items: center; justify-content: space-between; }
    .changelog-close { background: none; border: none; color: var(--muted); cursor: pointer; font-size: 18px; line-height: 1; }
    .changelog-close:hover { color: var(--text); }
    .changelog-entry { margin-bottom: 12px; }
    .changelog-entry:last-child { margin-bottom: 0; }
    .changelog-version { font-size: 12px; font-weight: 700; color: var(--purple); margin-bottom: 3px; }
    .changelog-desc { font-size: 13px; color: var(--muted); line-height: 1.5; }

    @media (max-width: 640px) {
      header { padding: 14px 16px; }
      main { padding: 32px 14px 80px; }
      .results-grid { grid-template-columns: 1fr; }
      .two-col, .time-grid { grid-template-columns: 1fr; }
      .vibe-score-layout { flex-direction: column; }
      .competitor-grid { grid-template-columns: 1fr; }
      .win-grid { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>

<!-- ‚îÄ‚îÄ HEADER ‚îÄ‚îÄ -->
<header>
  <div class="logo">
    <div class="logo-text">‚ú® Vibe Check</div>
    <div class="logo-badge">BETA</div>
  </div>
</header>

<!-- ‚îÄ‚îÄ MAIN ‚îÄ‚îÄ -->
<main>

  <!-- INPUT -->
  <section class="hero" id="input-section">
    <h1>Know <span>before</span> you build.</h1>
    <p>Describe any product idea ‚Äî get a real-time deep analysis in seconds.</p>

    <div class="input-card">
      <textarea
        id="idea-input"
        placeholder="e.g. A Chrome extension that blocks distracting websites during focus sessions and sends you weekly productivity reports..."
      ></textarea>

      <div class="skill-section">
        <div class="skill-header">
          <span class="skill-header-label">Your level</span>
          <span class="skill-current" id="skill-display">üå± Beginner</span>
        </div>
        <div class="slider-wrap">
          <input type="range" id="skill-range" min="0" max="3" step="1" value="1" />
          <div class="slider-labels">
            <span id="lbl-0" class="">üéÆ Vibe Coder</span>
            <span id="lbl-1" class="active">üå± Beginner</span>
            <span id="lbl-2" class="">üíª Intermediate</span>
            <span id="lbl-3" class="">üöÄ Senior</span>
          </div>
        </div>
      </div>

      <div class="input-footer">
        <button class="analyze-btn" id="analyze-btn" onclick="startAnalysis()">
          ‚ú® Analyze Idea
        </button>
      </div>
    </div>
  </section>

  <!-- PROGRESS -->
  <section id="progress-section">
    <div class="progress-header">
      <p id="progress-message">Initializing research agents...</p>
    </div>
    <div class="progress-steps">
      <div class="progress-step" id="step-market"><div class="step-dot"></div>Market</div>
      <div class="progress-step" id="step-technical"><div class="step-dot"></div>Technical</div>
      <div class="progress-step" id="step-opportunity"><div class="step-dot"></div>Opportunity</div>
      <div class="progress-step" id="step-deployment"><div class="step-dot"></div>Deployment</div>
      <div class="progress-step" id="step-sentiment"><div class="step-dot"></div>Sentiment</div>
    </div>
  </section>

  <!-- RESULTS -->
  <section id="results-section">
    <div class="results-header">
      <h2 id="results-title">Analysis Complete</h2>
      <p id="results-subtitle">Here's your full breakdown.</p>
    </div>

    <div class="results-grid">

      <!-- 1. VIBE SCORE (hero, full width) -->
      <div class="result-card vibe-hero" id="card-vibe">
        <div class="card-header">
          <div class="card-icon icon-pink">üìä</div>
          <div><div class="card-title">Vibe Score</div><div class="card-subtitle">Overall opportunity assessment</div></div>
        </div>
        <div class="card-body" id="body-vibe">
          <div class="skeleton" style="height:90px"></div>
        </div>
      </div>

      <!-- 2. MARKET (half) -->
      <div class="result-card" id="card-market">
        <div class="card-header">
          <div class="card-icon icon-purple">üîç</div>
          <div><div class="card-title">Market Overview</div><div class="card-subtitle">Saturation & landscape</div></div>
        </div>
        <div class="card-body" id="body-market">
          <div class="skeleton" style="height:50px;margin-bottom:10px"></div>
          <div class="skeleton" style="height:80px"></div>
        </div>
      </div>

      <!-- 3. AUDIENCE & REVENUE (half) -->
      <div class="result-card" id="card-audience">
        <div class="card-header">
          <div class="card-icon icon-cyan">üë•</div>
          <div><div class="card-title">Audience & Revenue</div><div class="card-subtitle">Who pays and how</div></div>
        </div>
        <div class="card-body" id="body-audience">
          <div class="skeleton" style="height:100px;margin-bottom:10px"></div>
          <div class="skeleton" style="height:80px"></div>
        </div>
      </div>

      <!-- 4. COMPETITORS (full width) -->
      <div class="result-card full" id="card-competitors">
        <div class="card-header">
          <div class="card-icon icon-red">üèÜ</div>
          <div><div class="card-title">Competitors</div><div class="card-subtitle">Who's already in the space</div></div>
        </div>
        <div class="card-body" id="body-competitors">
          <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px">
            <div class="skeleton" style="height:100px"></div>
            <div class="skeleton" style="height:100px"></div>
            <div class="skeleton" style="height:100px"></div>
          </div>
        </div>
      </div>

      <!-- 5. BUILD IT (half) -->
      <div class="result-card" id="card-build">
        <div class="card-header">
          <div class="card-icon icon-yellow">üõ†</div>
          <div><div class="card-title">Build It</div><div class="card-subtitle">Difficulty, time & stack</div></div>
        </div>
        <div class="card-body" id="body-build">
          <div class="skeleton" style="height:70px;margin-bottom:10px"></div>
          <div class="skeleton" style="height:90px"></div>
        </div>
      </div>

      <!-- 6. SHIP IT (half) -->
      <div class="result-card" id="card-ship">
        <div class="card-header">
          <div class="card-icon icon-green">üöÄ</div>
          <div><div class="card-title">Ship It</div><div class="card-subtitle">Where to deploy</div></div>
        </div>
        <div class="card-body" id="body-ship">
          <div class="skeleton" style="height:70px;margin-bottom:10px"></div>
          <div class="skeleton" style="height:100px"></div>
        </div>
      </div>

      <!-- 7. REDDIT PULSE (full width) -->
      <div class="result-card full" id="card-reddit">
        <div class="card-header">
          <div class="card-icon icon-purple">üí¨</div>
          <div><div class="card-title">Reddit Pulse</div><div class="card-subtitle">What people are actually saying</div></div>
        </div>
        <div class="card-body" id="body-reddit">
          <div class="skeleton" style="height:50px;margin-bottom:8px"></div>
          <div class="skeleton" style="height:50px;margin-bottom:8px"></div>
          <div class="skeleton" style="height:50px"></div>
        </div>
      </div>

      <!-- 8. HOW TO WIN (full width) -->
      <div class="result-card full" id="card-win">
        <div class="card-header">
          <div class="card-icon icon-pink">üéØ</div>
          <div><div class="card-title">How to Win</div><div class="card-subtitle">Differentiators & improvements</div></div>
        </div>
        <div class="card-body" id="body-win">
          <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px">
            <div class="skeleton" style="height:80px"></div>
            <div class="skeleton" style="height:80px"></div>
            <div class="skeleton" style="height:80px"></div>
          </div>
        </div>
      </div>

    </div><!-- /results-grid -->

    <div class="new-analysis-wrap">
      <button class="analyze-btn" onclick="resetApp()" style="margin:0 auto">‚Ü© Analyze Another Idea</button>
    </div>
  </section>

</main>

<!-- ‚îÄ‚îÄ VERSION BADGE ‚îÄ‚îÄ -->
<button class="version-badge" onclick="openChangelog()">v1.1</button>

<!-- ‚îÄ‚îÄ CHANGELOG MODAL ‚îÄ‚îÄ -->
<div class="changelog-overlay hidden" id="changelog-overlay" onclick="closeChangelog(event)">
  <div class="changelog-modal">
    <h3>
      What's New
      <button class="changelog-close" onclick="closeChangelog()">√ó</button>
    </h3>
    <div class="changelog-entry">
      <div class="changelog-version">v1.1 ‚Äî Current</div>
      <div class="changelog-desc">Redesigned UI ‚Äî consolidated cards, skill level slider, cleaner results layout, Reddit quotes view.</div>
    </div>
    <div class="changelog-entry">
      <div class="changelog-version">v1.0 ‚Äî Initial launch</div>
      <div class="changelog-desc">First version live with Perplexity-powered analysis across market, technical, opportunity, and deployment sections.</div>
    </div>
  </div>
</div>

<script>
// ‚îÄ‚îÄ SKILL SLIDER ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const SKILLS = [
  { key: 'vibe_coder',    label: 'üéÆ Vibe Coder' },
  { key: 'beginner',      label: 'üå± Beginner' },
  { key: 'intermediate',  label: 'üíª Intermediate' },
  { key: 'senior',        label: 'üöÄ Senior Dev' },
];
let selectedSkill = 'beginner';

const skillRange = document.getElementById('skill-range');
const skillDisplay = document.getElementById('skill-display');

function updateSlider(val) {
  selectedSkill = SKILLS[val].key;
  skillDisplay.textContent = SKILLS[val].label;
  // Update gradient fill
  const pct = (val / 3) * 100;
  skillRange.style.background = `linear-gradient(to right, var(--purple) ${pct}%, var(--subtle) ${pct}%)`;
  // Update labels
  for (let i = 0; i <= 3; i++) {
    const el = document.getElementById(`lbl-${i}`);
    el.classList.toggle('active', i === val);
  }
}

skillRange.addEventListener('input', e => updateSlider(parseInt(e.target.value)));
updateSlider(1); // default: beginner

// ‚îÄ‚îÄ HELPERS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const scoreColor = s => s>=8?'var(--green)':s>=6?'var(--yellow)':s>=4?'var(--purple)':'var(--red)';
const diffColor  = s => s<=3?'var(--green)':s<=5?'var(--yellow)':s<=7?'var(--purple)':'var(--red)';
const fmtScore   = n => Math.max(1, Math.min(10, parseInt(n)||5));

function scoreRing(score, color, size=70) {
  const r=size*0.4, cx=size/2, cy=size/2, circ=2*Math.PI*r, pct=score/10;
  return `<div class="diff-score-ring" style="width:${size}px;height:${size}px">
    <svg width="${size}" height="${size}" viewBox="0 0 ${size} ${size}">
      <circle cx="${cx}" cy="${cy}" r="${r}" fill="none" stroke="var(--subtle)" stroke-width="6"/>
      <circle cx="${cx}" cy="${cy}" r="${r}" fill="none" stroke="${color}" stroke-width="6"
        stroke-dasharray="${circ}" stroke-dashoffset="${circ*(1-pct)}" stroke-linecap="round"/>
    </svg>
    <div class="diff-ring-text">
      <strong style="color:${color}">${score}</strong>
      <span>/ 10</span>
    </div>
  </div>`;
}

const existInfo = e => ({
  fully_exists:    {label:'Already Exists',   color:'var(--red)',    dot:'var(--red)',    bg:'rgba(239,68,68,0.08)'},
  mostly_exists:   {label:'Mostly Exists',    color:'var(--yellow)', dot:'var(--yellow)', bg:'rgba(245,158,11,0.08)'},
  partially_exists:{label:'Partially Exists', color:'var(--yellow)', dot:'var(--yellow)', bg:'rgba(245,158,11,0.08)'},
  significant_gap: {label:'Significant Gap',  color:'var(--cyan)',   dot:'var(--cyan)',   bg:'rgba(6,182,212,0.08)'},
  blue_ocean:      {label:'üåä Blue Ocean',    color:'var(--green)',  dot:'var(--green)',  bg:'rgba(16,185,129,0.08)'},
}[e] || {label:e, color:'var(--muted)', dot:'var(--muted)', bg:'var(--subtle)'});

const trendIcon  = {rapidly_growing:'üöÄ',growing:'üìà',stable:'‚û°Ô∏è',declining:'üìâ',emerging:'üå±'};
const recLevel   = l => l==='highly_recommended'?'high':l==='recommended'?'med':'low';
const recLabel   = l => ({highly_recommended:'‚úÖ Top pick',recommended:'üëç Good fit',possible:'ü§î Possible',not_recommended:'‚ùå Skip'}[l]||l);
const platEmoji  = p => ({web_app:'üåê',mobile_ios:'üì±',mobile_android:'üì±',mobile_cross_platform:'üì±',chrome_extension:'üîå',shopify_app:'üõçÔ∏è',wordpress_plugin:'üìù',desktop_mac:'üñ•Ô∏è',desktop_windows:'üñ•Ô∏è',desktop_cross_platform:'üñ•Ô∏è',api_service:'‚öôÔ∏è',slack_app:'üí¨',vs_code_extension:'üíª',notion_integration:'üìí'}[p]||'üåê');
const priorityPill = p => p==='high'?'<span class="pill pill-red" style="font-size:11px">üî• High</span>':p==='medium'?'<span class="pill pill-yellow" style="font-size:11px">‚ö° Med</span>':'<span class="pill pill-muted" style="font-size:11px">Low</span>';
const effortPill   = e => e==='low'?'<span class="pill pill-green" style="font-size:11px">Easy</span>':e==='high'?'<span class="pill pill-red" style="font-size:11px">Hard</span>':'<span class="pill pill-yellow" style="font-size:11px">Medium</span>';

function makeVisible(id) { document.getElementById(id)?.classList.add('visible'); }

// stored cross-event data
let _marketData = null;
let _opportunityData = null;

// ‚îÄ‚îÄ RENDER: VIBE SCORE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function renderVibeScore() {
  if (!_opportunityData) return;
  const d = _opportunityData;
  const score = fmtScore(d.opportunity_score);
  const color = scoreColor(score);
  const marketSummary = _marketData?.market_summary || '';

  document.getElementById('body-vibe').innerHTML = `
    <div class="vibe-score-layout">
      <div class="vibe-grade-block">
        <div class="vibe-grade">${d.opportunity_grade||'?'}</div>
        <div class="vibe-score-num">${score} / 10</div>
      </div>
      <div class="vibe-content">
        <h3>${d.opportunity_summary||''}</h3>
        ${marketSummary ? `<p>${marketSummary}</p>` : ''}
        <div class="vibe-pills">
          ${d.opportunity_type ? `<span class="pill pill-purple">${d.opportunity_type.replace(/_/g,' ')}</span>` : ''}
          ${d.trend ? `<span class="pill pill-cyan">${trendIcon[d.trend]||''} ${d.trend.replace(/_/g,' ')}</span>` : ''}
          ${d.market_size ? `<span class="pill pill-muted">üì¶ ${d.market_size}</span>` : ''}
          ${d.trend_evidence ? `<span class="pill pill-muted" style="max-width:320px;overflow:hidden;text-overflow:ellipsis">üìä ${d.trend_evidence}</span>` : ''}
        </div>
      </div>
    </div>`;
  makeVisible('card-vibe');
}

// ‚îÄ‚îÄ RENDER: MARKET OVERVIEW ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function renderMarket(d) {
  _marketData = d;
  const ei = existInfo(d.exists);
  const sat = fmtScore(d.saturation_score);
  const satColor = sat>=8?'var(--red)':sat>=5?'var(--yellow)':'var(--green)';

  document.getElementById('body-market').innerHTML = `
    <div class="exists-badge" style="background:${ei.bg};color:${ei.color}">
      <div class="exists-dot" style="background:${ei.dot}"></div>${ei.label}
    </div>
    <div class="sat-block">
      <div class="sat-label"><span>Market Saturation</span><strong style="color:${satColor}">${sat}/10</strong></div>
      <div class="sat-track"><div class="sat-fill" style="width:${sat*10}%;background:${satColor}"></div></div>
    </div>`;
  makeVisible('card-market');

  // Competitors
  const comps = d.competitors || [];
  document.getElementById('body-competitors').innerHTML = comps.length
    ? `<div class="competitor-grid">
        ${comps.map(c=>`
          <div class="comp-card">
            <div class="comp-name">${c.url?`<a href="${c.url}" target="_blank" rel="noopener">${c.name} ‚Üó</a>`:c.name}
              ${c.pricing?` <span class="pill pill-muted" style="font-size:11px">${c.pricing}</span>`:''}
            </div>
            <div class="comp-desc">${c.description||''}</div>
            <div class="comp-sw">
              ${(c.strengths||[]).slice(0,2).map(s=>`<div class="comp-sw-item"><span style="color:var(--green)">‚úÖ</span>${s}</div>`).join('')}
              ${(c.weaknesses||[]).slice(0,2).map(w=>`<div class="comp-sw-item"><span style="color:var(--red)">‚ö†Ô∏è</span>${w}</div>`).join('')}
            </div>
          </div>`).join('')}
       </div>`
    : '<p style="color:var(--muted);font-size:13px">No major competitors found ‚Äî possible blue ocean.</p>';
  makeVisible('card-competitors');

  // Try rendering vibe score now that market summary is available
  renderVibeScore();
  renderHowToWin();
}

// ‚îÄ‚îÄ RENDER: AUDIENCE & REVENUE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function renderAudience(d) {
  const audiences = d.target_audiences || [];
  const revenues  = d.monetization_strategies || [];

  document.getElementById('body-audience').innerHTML = `
    ${audiences.length ? `
      <div class="sec-label">Audiences</div>
      ${audiences.slice(0,3).map(a=>`
        <div class="audience-row">
          <div class="audience-row-main">
            <strong>${a.segment||a}</strong>
            ${a.size||a.willingness_to_pay ? `<span>${[a.size, a.willingness_to_pay ? 'Pays: '+a.willingness_to_pay : ''].filter(Boolean).join(' ¬∑ ')}</span>` : ''}
          </div>
        </div>`).join('')}
    ` : ''}
    ${revenues.length ? `
      <div class="sec-label">Revenue Models</div>
      ${revenues.slice(0,3).map(m=>`
        <div class="rev-row">
          <div>
            <div class="rev-model">${m.model}</div>
            ${m.description?`<div class="rev-desc">${m.description}</div>`:''}
          </div>
          ${m.revenue_potential ? `<div class="rev-badge"><span class="pill pill-green" style="font-size:11px">${m.revenue_potential}</span></div>` : ''}
        </div>`).join('')}
    ` : ''}`;
  makeVisible('card-audience');
}

// ‚îÄ‚îÄ RENDER: BUILD IT ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function renderBuild(d) {
  const score = fmtScore(d.difficulty_score);
  const color = diffColor(score);
  const dlLabels = {no_code:'üéÆ No-Code',beginner:'üå± Beginner',intermediate:'üíª Intermediate',advanced:'üî• Advanced',expert:'üöÄ Expert'};
  const dl = dlLabels[d.difficulty] || d.difficulty || '?';
  const t = d.time_estimates || {};
  const times = [{l:'üéÆ Vibe',v:t.vibe_coder},{l:'üå± Beg.',v:t.beginner},{l:'üíª Inter.',v:t.intermediate},{l:'üöÄ Senior',v:t.senior_dev}].filter(x=>x.v);
  const stack = d.tech_stack || {};
  const stackItems = [{l:'Frontend',v:stack.frontend},{l:'Backend',v:stack.backend},{l:'Database',v:stack.database},{l:'Hosting',v:stack.hosting}].filter(s=>s.v);

  document.getElementById('body-build').innerHTML = `
    <div class="diff-display">
      ${scoreRing(score, color, 70)}
      <div>
        <strong style="font-size:16px;color:${color}">${dl}</strong>
        <p style="font-size:12px;color:var(--muted);margin-top:4px;line-height:1.5">${d.technical_summary||''}</p>
      </div>
    </div>
    ${times.length ? `
      <div class="sec-label">Time to Build</div>
      <div class="time-grid">${times.map(t=>`<div class="time-cell"><small>${t.l}</small><strong>${t.v}</strong></div>`).join('')}</div>
    ` : ''}
    ${stackItems.length ? `
      <div class="sec-label">Stack</div>
      <div class="two-col">${stackItems.map(s=>`<div class="data-block"><small>${s.l}</small><span>${s.v}</span></div>`).join('')}</div>
    ` : ''}
    ${(d.required_apis||[]).length ? `
      <div class="sec-label">Key APIs</div>
      ${d.required_apis.slice(0,3).map(a=>`
        <div class="item-row">
          <div class="item-icon">üîó</div>
          <div class="item-body">
            <strong>${a.url?`<a href="${a.url}" target="_blank" style="color:var(--text);text-decoration:none">${a.name} ‚Üó</a>`:a.name}</strong>
            <span>${a.cost||''}</span>
          </div>
        </div>`).join('')}
    ` : ''}`;
  makeVisible('card-build');
}

// ‚îÄ‚îÄ RENDER: SHIP IT ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function renderShip(d) {
  const primary = d.primary_recommendation || 'web_app';
  const opts = (d.deployment_options || []).filter(o => o.recommendation_level !== 'not_recommended').slice(0, 4);

  document.getElementById('body-ship').innerHTML = `
    <div class="platform-hero">
      <div class="platform-emoji">${platEmoji(primary)}</div>
      <div>
        <div class="platform-name">${primary.replace(/_/g,' ').replace(/\b\w/g,l=>l.toUpperCase())}</div>
        <div class="platform-reason">${d.quick_win_approach || d.reasoning || ''}</div>
      </div>
    </div>
    ${opts.length ? `
      <div class="platform-list">
        ${opts.map(o=>`
          <div class="plat-row ${recLevel(o.recommendation_level)}">
            <div style="font-size:15px">${platEmoji(o.platform?.toLowerCase().replace(/\s+/g,'_'))}</div>
            <div class="plat-row-name">${o.platform}</div>
            <div class="plat-row-meta">${o.time_to_market||''}</div>
            <span class="pill ${recLevel(o.recommendation_level)==='high'?'pill-green':recLevel(o.recommendation_level)==='med'?'pill-yellow':'pill-muted'}" style="font-size:11px">${recLabel(o.recommendation_level)}</span>
          </div>`).join('')}
      </div>
    ` : ''}`;
  makeVisible('card-ship');
}

// ‚îÄ‚îÄ RENDER: REDDIT PULSE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function renderReddit(d) {
  const results = d.results || [];
  if (!results.length) {
    document.getElementById('body-reddit').innerHTML = '<p style="color:var(--muted);font-size:13px">No relevant Reddit posts found yet.</p>';
    makeVisible('card-reddit');
    return;
  }

  document.getElementById('body-reddit').innerHTML = results.map(group => `
    <div class="reddit-group">
      <div class="reddit-group-label">${group.competitor}</div>
      ${(group.posts||[]).map(p=>`
        <a href="${p.url}" target="_blank" rel="noopener" class="reddit-quote">
          <div style="flex:1">
            <div class="reddit-quote-text">"${p.title}"</div>
            <div class="reddit-quote-src">r/${p.subreddit}</div>
          </div>
          <div class="reddit-arrow">‚Üí</div>
        </a>`).join('')}
    </div>`).join('');
  makeVisible('card-reddit');
}

// ‚îÄ‚îÄ RENDER: HOW TO WIN ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function renderHowToWin() {
  const differentiators = (_marketData?.key_differentiators_needed || []).map(d => ({ type: 'diff', text: d }));
  const improvements    = (_opportunityData?.improvement_suggestions || []);
  if (!differentiators.length && !improvements.length) return;

  const diffCards = differentiators.slice(0, 3).map(d => `
    <div class="win-card">
      <div class="win-card-header">
        <span style="font-size:16px">üéØ</span>
        <div class="win-card-title">${d.text}</div>
      </div>
      <div class="win-badges"><span class="pill pill-cyan" style="font-size:11px">Differentiator</span></div>
    </div>`).join('');

  const impCards = improvements.slice(0, 4).map(i => `
    <div class="win-card">
      <div class="win-card-header">
        <span style="font-size:16px">üí°</span>
        <div class="win-card-title">${i.suggestion}</div>
      </div>
      <div class="win-card-reason">${i.reasoning||''}</div>
      <div class="win-badges">${priorityPill(i.priority)}${effortPill(i.effort)}</div>
    </div>`).join('');

  document.getElementById('body-win').innerHTML = `<div class="win-grid">${diffCards}${impCards}</div>`;
  makeVisible('card-win');
}

// ‚îÄ‚îÄ PROGRESS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function setStep(phase, state) {
  const el = document.getElementById(`step-${phase}`);
  if (!el) return;
  el.classList.remove('active','done');
  el.classList.add(state);
}
function setProgressMsg(msg) {
  const el = document.getElementById('progress-message');
  if (el) el.innerHTML = msg;
}

// ‚îÄ‚îÄ EVENT HANDLER ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function handleEvent(event, data) {
  switch(event) {
    case 'status':
      setProgressMsg(data.message);
      if (data.phase) setStep(data.phase, 'active');
      break;
    case 'market':
      setStep('market','done');
      renderMarket(data);
      break;
    case 'technical':
      setStep('technical','done');
      renderBuild(data);
      break;
    case 'opportunity':
      setStep('opportunity','done');
      _opportunityData = data;
      renderVibeScore();
      renderAudience(data);
      renderHowToWin();
      break;
    case 'deployment':
      setStep('deployment','done');
      renderShip(data);
      break;
    case 'sentiment':
      setStep('sentiment','done');
      renderReddit(data);
      break;
    case 'complete':
      setProgressMsg('‚úÖ Analysis complete!');
      const title = currentIdea.substring(0,55)+(currentIdea.length>55?'‚Ä¶':'');
      document.getElementById('results-title').textContent = title;
      break;
    case 'error':
      setProgressMsg(`‚ùå ${data.message}`);
      break;
  }
}

// ‚îÄ‚îÄ MAIN FLOW ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
let currentIdea = '';

async function startAnalysis() {
  const idea = document.getElementById('idea-input').value.trim();
  if (!idea) {
    document.getElementById('idea-input').style.borderColor = 'var(--red)';
    setTimeout(() => document.getElementById('idea-input').style.borderColor = '', 2000);
    return;
  }
  currentIdea = idea;
  _marketData = null;
  _opportunityData = null;

  document.getElementById('input-section').style.display = 'none';
  document.getElementById('progress-section').style.display = 'block';
  document.getElementById('results-section').style.display = 'block';

  // Reset all cards
  ['vibe','market','audience','competitors','build','ship','reddit','win'].forEach(id => {
    document.getElementById(`card-${id}`)?.classList.remove('visible');
  });
  ['market','technical','opportunity','deployment','sentiment'].forEach(s => {
    const el = document.getElementById(`step-${s}`);
    if (el) el.classList.remove('active','done');
  });
  setProgressMsg('Spinning up research agents...');

  const response = await fetch('/api/analyze', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ idea, skillLevel: selectedSkill }),
  });

  if (!response.ok) { alert('Server error: ' + response.statusText); resetApp(); return; }

  const reader = response.body.getReader();
  const decoder = new TextDecoder();
  let buffer = '';

  while (true) {
    const { done, value } = await reader.read();
    if (done) break;
    buffer += decoder.decode(value, { stream: true });
    const parts = buffer.split('\n\n');
    buffer = parts.pop();
    for (const part of parts) {
      if (!part.trim()) continue;
      const lines = part.split('\n');
      let event = 'message', dataStr = '';
      for (const line of lines) {
        if (line.startsWith('event: ')) event = line.slice(7).trim();
        if (line.startsWith('data: '))  dataStr = line.slice(6).trim();
      }
      if (!dataStr) continue;
      let data; try { data = JSON.parse(dataStr); } catch { continue; }
      handleEvent(event, data);
    }
  }
}

function resetApp() {
  document.getElementById('input-section').style.display = '';
  document.getElementById('progress-section').style.display = 'none';
  document.getElementById('results-section').style.display = 'none';
  document.getElementById('idea-input').value = '';
}

// ‚îÄ‚îÄ CHANGELOG ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function openChangelog() {
  document.getElementById('changelog-overlay').classList.remove('hidden');
}
function closeChangelog(e) {
  if (!e || e.target === document.getElementById('changelog-overlay') || e.type === 'click') {
    document.getElementById('changelog-overlay').classList.add('hidden');
  }
}

// ‚îÄ‚îÄ KEYBOARD SHORTCUT ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
document.getElementById('idea-input').addEventListener('keydown', e => {
  if (e.key === 'Enter' && (e.metaKey || e.ctrlKey)) startAnalysis();
});
</script>
</body>
</html>
