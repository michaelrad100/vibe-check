<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Vibe Check ‚Äî Know Before You Build</title>
  <style>
    :root {
      --bg: #07070f;
      --card-bg: #0d0d1a;
      --card-border: #1a1a30;
      --purple: #8b5cf6;
      --pink: #ec4899;
      --blue: #3b82f6;
      --cyan: #06b6d4;
      --green: #10b981;
      --yellow: #f59e0b;
      --red: #ef4444;
      --text: #e2e8f0;
      --muted: #64748b;
      --subtle: #1e1e3a;
      --radius: 14px;
      --grad: linear-gradient(135deg, var(--purple), var(--pink));
    }
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      background: var(--bg); color: var(--text);
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      min-height: 100vh; overflow-x: hidden;
    }
    body::before {
      content: ''; position: fixed; top: -20%; left: 50%; transform: translateX(-50%);
      width: 70vw; height: 50vh;
      background: radial-gradient(ellipse, rgba(139,92,246,0.1) 0%, transparent 70%);
      pointer-events: none; z-index: 0;
    }

    /* ‚îÄ‚îÄ HEADER ‚îÄ‚îÄ */
    header {
      position: relative; z-index: 1;
      display: flex; align-items: center; padding: 20px 32px;
      border-bottom: 1px solid var(--card-border);
    }
    .logo { display: flex; align-items: center; gap: 10px; }
    .logo-text {
      font-size: 17px; font-weight: 700; letter-spacing: -0.01em;
      background: var(--grad);
      -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;
    }
    .logo-badge {
      font-size: 10px; background: var(--subtle); color: var(--purple);
      border: 1px solid rgba(139,92,246,0.35); border-radius: 5px;
      padding: 2px 7px; font-weight: 700; letter-spacing: 0.05em;
    }

    /* ‚îÄ‚îÄ MAIN ‚îÄ‚îÄ */
    main { position: relative; z-index: 1; max-width: 1080px; margin: 0 auto; padding: 52px 24px 100px; }

    /* ‚îÄ‚îÄ HERO ‚îÄ‚îÄ */
    .hero { text-align: center; margin-bottom: 44px; }
    .hero h1 {
      font-size: clamp(34px, 5vw, 52px); font-weight: 800;
      line-height: 1.12; letter-spacing: -0.02em; margin-bottom: 14px;
    }
    .hero h1 span {
      background: var(--grad);
      -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;
    }
    .hero p { color: var(--muted); font-size: 17px; }

    /* ‚îÄ‚îÄ INPUT CARD ‚îÄ‚îÄ */
    .input-card {
      background: var(--card-bg); border: 1px solid var(--card-border);
      border-radius: 20px; padding: 24px;
      box-shadow: 0 24px 64px rgba(0,0,0,0.3); margin-top: 36px;
    }
    .textarea-section { margin-top: 20px; }
    .input-card textarea {
      width: 100%; background: var(--subtle); border: 1px solid var(--card-border);
      border-radius: 12px; padding: 16px 18px; color: var(--text);
      font-size: 15px; font-family: inherit; resize: none; height: 110px;
      outline: none; transition: border-color 0.2s; line-height: 1.65;
    }
    .input-card textarea:focus { border-color: var(--purple); }
    .input-card textarea::placeholder { color: var(--muted); }

    /* ‚îÄ‚îÄ SEGMENTED CONTROL ‚îÄ‚îÄ */
    .skill-section { margin-bottom: 0; }
    .skill-label-row { margin-bottom: 10px; }
    .skill-label-text {
      font-size: 11px; font-weight: 700; text-transform: uppercase;
      letter-spacing: 0.09em; color: var(--muted);
    }
    .segmented {
      display: grid; grid-template-columns: repeat(4, 1fr);
      background: var(--subtle); border-radius: 11px; padding: 3px; gap: 2px;
    }
    .seg-btn {
      padding: 9px 8px; border-radius: 8px; text-align: center;
      cursor: pointer; font-size: 13px; font-weight: 600;
      color: var(--muted); transition: all 0.18s;
      border: none; background: none; font-family: inherit;
      white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
    }
    .seg-btn:hover:not(.active) { color: var(--text); }
    .seg-btn.active {
      background: var(--card-bg); color: var(--purple);
      box-shadow: 0 1px 6px rgba(0,0,0,0.35);
    }

    /* ‚îÄ‚îÄ WEB3 ANALYZE BUTTON ‚îÄ‚îÄ */
    .analyze-btn {
      display: block; width: 100%; margin-top: 20px;
      background: var(--grad); color: white; border: none;
      border-radius: 14px; padding: 20px 32px;
      font-size: 18px; font-weight: 800; letter-spacing: -0.01em;
      cursor: pointer; font-family: inherit; text-align: center;
      transition: all 0.25s;
      box-shadow: 0 0 40px rgba(139,92,246,0.3), 0 8px 32px rgba(0,0,0,0.3);
    }
    .analyze-btn:hover {
      opacity: 0.92; transform: translateY(-2px);
      box-shadow: 0 0 64px rgba(139,92,246,0.5), 0 12px 40px rgba(0,0,0,0.4);
    }
    .analyze-btn:disabled { opacity: 0.45; cursor: not-allowed; transform: none; box-shadow: none; }
    .analyze-btn.secondary {
      background: var(--subtle); color: var(--text);
      font-size: 15px; padding: 14px 28px; width: auto; display: inline-block;
      box-shadow: none; border: 1px solid var(--card-border); font-weight: 700;
    }
    .analyze-btn.secondary:hover { background: #252545; box-shadow: none; transform: none; opacity: 1; }

    /* ‚îÄ‚îÄ PROGRESS ‚îÄ‚îÄ */
    #progress-section { margin-bottom: 52px; display: none; }
    .progress-header { text-align: center; margin-bottom: 20px; }
    .progress-msg { font-size: 13px; color: var(--muted); }
    .progress-steps { display: flex; justify-content: center; gap: 8px; flex-wrap: wrap; }
    .progress-step {
      display: flex; align-items: center; gap: 6px;
      background: var(--card-bg); border: 1px solid var(--card-border);
      border-radius: 100px; padding: 6px 14px; font-size: 12px; font-weight: 500; color: var(--muted);
      transition: all 0.3s;
    }
    .progress-step.active { border-color: var(--purple); color: var(--purple); background: rgba(139,92,246,0.08); }
    .progress-step.done  { border-color: var(--green);  color: var(--green);  background: rgba(16,185,129,0.08); }
    .step-dot { width: 6px; height: 6px; border-radius: 50%; background: currentColor; flex-shrink: 0; }
    .progress-step.active .step-dot { animation: pulse 1s infinite; }
    @keyframes pulse { 0%,100%{opacity:1}50%{opacity:0.3} }

    /* ‚îÄ‚îÄ RESULTS HEADER ‚îÄ‚îÄ */
    #results-section { display: none; }
    .results-header {
      margin-bottom: 36px; padding-bottom: 28px;
      border-bottom: 1px solid var(--card-border); text-align: center;
    }
    .results-eyebrow {
      font-size: 11px; font-weight: 700; text-transform: uppercase;
      letter-spacing: 0.12em; color: var(--muted); margin-bottom: 14px;
    }
    .results-idea {
      font-size: clamp(20px, 2.5vw, 26px); font-weight: 600;
      line-height: 1.4; letter-spacing: -0.01em; color: var(--text);
      max-width: 720px; margin: 0 auto;
    }

    /* ‚îÄ‚îÄ RESULTS LAYOUT: sidebar + content ‚îÄ‚îÄ */
    .results-layout { display: flex; gap: 32px; align-items: flex-start; }

    /* ‚îÄ‚îÄ SIDEBAR NAV ‚îÄ‚îÄ */
    .results-nav { width: 148px; flex-shrink: 0; position: sticky; top: 24px; }
    .nav-label {
      font-size: 10px; font-weight: 700; text-transform: uppercase;
      letter-spacing: 0.1em; color: var(--muted); margin-bottom: 10px; padding-left: 10px;
    }
    .nav-item {
      display: block; padding: 8px 10px; border-radius: 8px;
      font-size: 12px; font-weight: 500; color: var(--muted);
      cursor: pointer; transition: all 0.2s; margin-bottom: 2px;
      border-left: 2px solid transparent;
      white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
    }
    .nav-item:hover { color: var(--text); background: rgba(255,255,255,0.04); }
    .nav-item.active {
      color: var(--purple); background: rgba(139,92,246,0.08);
      border-left-color: var(--purple); font-weight: 700;
    }

    /* ‚îÄ‚îÄ RESULTS CONTENT + GRID ‚îÄ‚îÄ */
    .results-content { flex: 1; min-width: 0; }
    .results-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px; }

    /* ‚îÄ‚îÄ CARDS ‚îÄ‚îÄ */
    .result-card {
      background: var(--card-bg); border: 1px solid var(--card-border);
      border-radius: var(--radius); overflow: hidden;
      opacity: 0; transform: translateY(14px);
      transition: opacity 0.4s, transform 0.4s, border-color 0.2s;
      scroll-margin-top: 24px;
    }
    .result-card.visible { opacity: 1; transform: translateY(0); }
    .result-card.full { grid-column: 1 / -1; }
    .result-card.vibe-hero {
      grid-column: 1 / -1;
      border-color: rgba(139,92,246,0.28);
      background: linear-gradient(135deg, rgba(139,92,246,0.06), rgba(236,72,153,0.04));
    }
    .card-header {
      display: flex; align-items: center; gap: 12px;
      padding: 15px 20px; border-bottom: 1px solid var(--card-border);
    }
    .card-icon {
      width: 32px; height: 32px; border-radius: 8px;
      display: flex; align-items: center; justify-content: center;
      font-size: 14px; flex-shrink: 0;
    }
    .icon-purple { background: rgba(139,92,246,0.15); }
    .icon-pink   { background: rgba(236,72,153,0.15); }
    .icon-green  { background: rgba(16,185,129,0.15); }
    .icon-yellow { background: rgba(245,158,11,0.15); }
    .icon-cyan   { background: rgba(6,182,212,0.15); }
    .icon-red    { background: rgba(239,68,68,0.15); }
    .card-title   { font-size: 13px; font-weight: 700; color: var(--text); letter-spacing: -0.01em; }
    .card-subtitle{ font-size: 12px; color: var(--muted); margin-top: 2px; }
    .card-body { padding: 20px; }

    .skeleton {
      background: linear-gradient(90deg, var(--subtle) 25%, #1a1a35 50%, var(--subtle) 75%);
      background-size: 200% 100%; animation: shimmer 1.5s infinite; border-radius: 8px;
    }
    @keyframes shimmer { 0%{background-position:200% 0}100%{background-position:-200% 0} }

    /* ‚îÄ‚îÄ VIBE SCORE ‚îÄ‚îÄ */
    .vibe-layout { display: flex; gap: 28px; align-items: flex-start; }
    .vibe-grade-block { display: flex; flex-direction: column; align-items: center; gap: 4px; flex-shrink: 0; width: 72px; }
    .vibe-grade {
      font-size: 52px; font-weight: 900; line-height: 1; letter-spacing: -0.03em;
      background: var(--grad);
      -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;
    }
    .vibe-score-num { font-size: 12px; color: var(--muted); font-weight: 600; }
    .vibe-content { flex: 1; min-width: 0; }
    .vibe-summary { font-size: 16px; font-weight: 600; line-height: 1.45; margin-bottom: 8px; letter-spacing: -0.01em; }
    .vibe-detail  { font-size: 13px; color: var(--muted); line-height: 1.65; }
    .vibe-pills   { display: flex; gap: 6px; flex-wrap: wrap; margin-top: 14px; }

    /* ‚îÄ‚îÄ PILLS ‚îÄ‚îÄ */
    .pill { display: inline-flex; align-items: center; border-radius: 100px; padding: 3px 10px; font-size: 11px; font-weight: 600; white-space: nowrap; }
    .pill-purple { background: rgba(139,92,246,0.15); color: var(--purple); }
    .pill-green  { background: rgba(16,185,129,0.15); color: var(--green); }
    .pill-red    { background: rgba(239,68,68,0.15);  color: var(--red); }
    .pill-yellow { background: rgba(245,158,11,0.15); color: var(--yellow); }
    .pill-cyan   { background: rgba(6,182,212,0.15);  color: var(--cyan); }
    .pill-muted  { background: var(--subtle); color: var(--muted); }

    /* ‚îÄ‚îÄ SATURATION ‚îÄ‚îÄ */
    .exists-badge {
      display: inline-flex; align-items: center; gap: 8px;
      padding: 7px 12px; border-radius: 9px; font-size: 13px; font-weight: 600; margin-bottom: 14px;
    }
    .exists-dot { width: 8px; height: 8px; border-radius: 50%; flex-shrink: 0; }
    .sat-block { margin-bottom: 4px; }
    .sat-label { display: flex; justify-content: space-between; font-size: 12px; color: var(--muted); margin-bottom: 6px; }
    .sat-track { height: 7px; background: var(--subtle); border-radius: 100px; overflow: hidden; }
    .sat-fill  { height: 100%; border-radius: 100px; transition: width 0.8s ease; }

    /* ‚îÄ‚îÄ COMPETITORS ‚îÄ‚îÄ */
    .comp-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 12px; }
    .comp-card { background: var(--subtle); border: 1px solid var(--card-border); border-radius: 11px; padding: 14px; }
    .comp-name { font-size: 14px; font-weight: 700; margin-bottom: 5px; letter-spacing: -0.01em; }
    .comp-name a { color: var(--text); text-decoration: none; }
    .comp-name a:hover { color: var(--purple); }
    .comp-price { font-size: 11px; }
    .comp-desc { font-size: 12px; color: var(--muted); line-height: 1.55; margin-bottom: 8px; }
    .comp-sw-item { font-size: 12px; color: var(--muted); display: flex; gap: 5px; margin-bottom: 3px; line-height: 1.4; }

    /* ‚îÄ‚îÄ DATA BLOCKS ‚îÄ‚îÄ */
    .two-col { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 14px; }
    .data-block { background: var(--subtle); border-radius: 10px; padding: 12px; }
    .data-block small { display: block; font-size: 10px; color: var(--muted); font-weight: 700; text-transform: uppercase; letter-spacing: 0.09em; margin-bottom: 4px; }
    .data-block span { font-size: 13px; }

    /* ‚îÄ‚îÄ AUDIENCE / REVENUE ‚îÄ‚îÄ */
    .aud-row { display: flex; align-items: center; gap: 10px; padding: 10px 12px; background: var(--subtle); border-radius: 10px; margin-bottom: 8px; }
    .aud-row:last-child { margin-bottom: 0; }
    .aud-main strong { display: block; font-size: 13px; margin-bottom: 2px; }
    .aud-main span { font-size: 12px; color: var(--muted); }
    .rev-row { display: flex; align-items: flex-start; justify-content: space-between; gap: 10px; padding: 10px 12px; background: var(--subtle); border-radius: 10px; margin-bottom: 7px; }
    .rev-row:last-child { margin-bottom: 0; }
    .rev-model { font-size: 13px; font-weight: 700; margin-bottom: 2px; }
    .rev-desc  { font-size: 12px; color: var(--muted); }

    /* ‚îÄ‚îÄ DIFFICULTY RING ‚îÄ‚îÄ */
    .diff-display { display: flex; align-items: center; gap: 18px; margin-bottom: 18px; }
    .diff-ring { position: relative; width: 68px; height: 68px; flex-shrink: 0; }
    .diff-ring svg { transform: rotate(-90deg); }
    .diff-ring-text { position: absolute; inset: 0; display: flex; flex-direction: column; align-items: center; justify-content: center; }
    .diff-ring-text strong { font-size: 17px; font-weight: 800; }
    .diff-ring-text span { font-size: 10px; color: var(--muted); }

    /* ‚îÄ‚îÄ SECTION LABEL ‚îÄ‚îÄ */
    .sec-label {
      font-size: 10px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.1em;
      color: var(--muted); margin: 16px 0 10px;
      display: flex; align-items: center; gap: 8px;
    }
    .sec-label::after { content: ''; flex: 1; height: 1px; background: var(--card-border); }

    /* ‚îÄ‚îÄ ITEM ROWS ‚îÄ‚îÄ */
    .item-row { display: flex; gap: 8px; padding: 9px 12px; background: var(--subtle); border-radius: 10px; margin-bottom: 7px; align-items: flex-start; }
    .item-row:last-child { margin-bottom: 0; }
    .item-body strong { display: block; font-size: 13px; margin-bottom: 2px; }
    .item-body span { font-size: 12px; color: var(--muted); }

    /* ‚îÄ‚îÄ PLATFORM ‚îÄ‚îÄ */
    .plat-hero { display: flex; align-items: center; gap: 14px; padding: 13px 15px; border-radius: 11px; background: rgba(16,185,129,0.07); border: 1px solid rgba(16,185,129,0.18); margin-bottom: 14px; }
    .plat-emoji { font-size: 24px; }
    .plat-name { font-size: 15px; font-weight: 700; color: var(--green); letter-spacing: -0.01em; }
    .plat-reason { font-size: 12px; color: var(--muted); margin-top: 3px; line-height: 1.5; }
    .plat-list { display: flex; flex-direction: column; gap: 7px; }
    .plat-row { display: flex; align-items: center; gap: 10px; padding: 9px 12px; background: var(--subtle); border-radius: 9px; border-left: 3px solid transparent; }
    .plat-row.high { border-left-color: var(--green); }
    .plat-row.med  { border-left-color: var(--yellow); }
    .plat-row.low  { border-left-color: var(--red); }
    .plat-name-txt { font-size: 13px; font-weight: 600; flex: 1; }
    .plat-meta { font-size: 11px; color: var(--muted); }

    /* ‚îÄ‚îÄ COMMUNITY PULSE ‚îÄ‚îÄ */
    .sentiment-cols { display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px; }
    .sentiment-col-label {
      font-size: 10px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.09em;
      margin-bottom: 10px; display: flex; align-items: center; gap: 6px;
    }
    .sentiment-item {
      padding: 12px 14px; background: var(--subtle); border-radius: 10px;
      border-left: 3px solid; margin-bottom: 8px;
    }
    .sentiment-item:last-child { margin-bottom: 0; }
    .sentiment-quote { font-size: 13px; line-height: 1.5; color: var(--text); }
    .sentiment-meta { font-size: 11px; color: var(--muted); margin-top: 6px; }

    /* ‚îÄ‚îÄ HOW TO WIN ‚îÄ‚îÄ */
    .win-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(270px, 1fr)); gap: 10px; }
    .win-card { background: var(--subtle); border: 1px solid var(--card-border); border-radius: 11px; padding: 14px; }
    .win-card-label { font-size: 10px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.07em; color: var(--muted); margin-bottom: 4px; }
    .win-card-title { font-size: 13px; font-weight: 700; line-height: 1.4; margin-bottom: 4px; }
    .win-card-reason { font-size: 12px; color: var(--muted); line-height: 1.55; }
    .win-badges { display: flex; gap: 5px; margin-top: 9px; flex-wrap: wrap; }

    /* ‚îÄ‚îÄ ACTION ROW ‚îÄ‚îÄ */
    .action-row { display: flex; gap: 12px; justify-content: center; margin-top: 48px; flex-wrap: wrap; }
    .share-btn {
      background: var(--subtle); color: var(--purple);
      border: 1px solid rgba(139,92,246,0.35); border-radius: 12px;
      padding: 14px 28px; font-size: 15px; font-weight: 700;
      cursor: pointer; transition: all 0.2s; font-family: inherit;
    }
    .share-btn:hover { background: rgba(139,92,246,0.1); border-color: var(--purple); }

    /* ‚îÄ‚îÄ VERSION BADGE ‚îÄ‚îÄ */
    .version-badge {
      position: fixed; bottom: 16px; right: 16px; z-index: 100;
      background: var(--card-bg); border: 1px solid var(--card-border);
      border-radius: 100px; padding: 5px 12px; font-size: 11px; color: var(--muted);
      cursor: pointer; transition: all 0.2s; font-weight: 600; font-family: inherit;
    }
    .version-badge:hover { border-color: var(--purple); color: var(--text); }

    /* ‚îÄ‚îÄ CHANGELOG ‚îÄ‚îÄ */
    .changelog-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.65); backdrop-filter: blur(6px); z-index: 999; display: flex; align-items: flex-end; justify-content: flex-end; padding: 20px; }
    .changelog-overlay.hidden { display: none; }
    .changelog-modal { background: var(--card-bg); border: 1px solid var(--card-border); border-radius: 16px; padding: 22px; width: 300px; box-shadow: 0 20px 60px rgba(0,0,0,0.5); }
    .changelog-modal h3 { font-size: 14px; font-weight: 700; margin-bottom: 16px; display: flex; align-items: center; justify-content: space-between; }
    .changelog-close { background: none; border: none; color: var(--muted); cursor: pointer; font-size: 18px; line-height: 1; padding: 0; font-family: inherit; }
    .changelog-close:hover { color: var(--text); }
    .changelog-entry { margin-bottom: 12px; }
    .changelog-entry:last-child { margin-bottom: 0; }
    .changelog-ver { font-size: 12px; font-weight: 700; color: var(--purple); margin-bottom: 3px; }
    .changelog-desc { font-size: 12px; color: var(--muted); line-height: 1.5; }

    /* ‚îÄ‚îÄ RESPONSIVE ‚îÄ‚îÄ */
    @media (max-width: 900px) { .results-nav { display: none; } }
    @media (max-width: 640px) {
      header { padding: 14px 16px; }
      main { padding: 32px 14px 80px; }
      .results-grid { grid-template-columns: 1fr; }
      .two-col { grid-template-columns: 1fr; }
      .vibe-layout { flex-direction: column; }
      .comp-grid { grid-template-columns: 1fr; }
      .win-grid { grid-template-columns: 1fr; }
      .sentiment-cols { grid-template-columns: 1fr; }
      .seg-btn { font-size: 11px; padding: 8px 4px; }
    }
  </style>
</head>
<body>

<header>
  <div class="logo">
    <div class="logo-text">‚ú® Vibe Check</div>
    <div class="logo-badge">BETA</div>
  </div>
</header>

<main>

  <!-- ‚îÄ‚îÄ INPUT ‚îÄ‚îÄ -->
  <section class="hero" id="input-section">
    <h1>Know <span>before</span> you build.</h1>
    <p>Describe any product idea ‚Äî get a real-time deep analysis in seconds.</p>

    <div class="input-card">
      <!-- Skill level FIRST -->
      <div class="skill-section">
        <div class="skill-label-row">
          <span class="skill-label-text">Your level</span>
        </div>
        <div class="segmented">
          <button class="seg-btn" onclick="selectSkill(0)">üéÆ Vibe Coder</button>
          <button class="seg-btn active" onclick="selectSkill(1)">üå± Beginner</button>
          <button class="seg-btn" onclick="selectSkill(2)">üíª Intermediate</button>
          <button class="seg-btn" onclick="selectSkill(3)">üöÄ Senior</button>
        </div>
      </div>

      <!-- Idea textarea -->
      <div class="textarea-section">
        <textarea
          id="idea-input"
          placeholder="e.g. A Chrome extension that blocks distracting websites during focus sessions and sends you weekly productivity reports..."
        ></textarea>
      </div>

      <!-- Big Web3 button, no emoji -->
      <button class="analyze-btn" id="analyze-btn" onclick="startAnalysis()">
        Analyze Idea ‚Üí
      </button>
    </div>
  </section>

  <!-- ‚îÄ‚îÄ PROGRESS ‚îÄ‚îÄ -->
  <section id="progress-section">
    <div class="progress-header">
      <p class="progress-msg" id="progress-message">Initializing research agents...</p>
    </div>
    <div class="progress-steps">
      <div class="progress-step" id="step-market"><div class="step-dot"></div>Market</div>
      <div class="progress-step" id="step-technical"><div class="step-dot"></div>Technical</div>
      <div class="progress-step" id="step-opportunity"><div class="step-dot"></div>Opportunity</div>
      <div class="progress-step" id="step-deployment"><div class="step-dot"></div>Deployment</div>
      <div class="progress-step" id="step-sentiment"><div class="step-dot"></div>Community</div>
    </div>
  </section>

  <!-- ‚îÄ‚îÄ RESULTS ‚îÄ‚îÄ -->
  <section id="results-section">

    <div class="results-header">
      <div class="results-eyebrow" id="results-eyebrow">Analyzing...</div>
      <div class="results-idea" id="results-idea"></div>
    </div>

    <div class="results-layout">

      <!-- Sticky sidebar nav -->
      <nav class="results-nav" id="results-nav">
        <div class="nav-label">Sections</div>
        <div class="nav-item" data-target="card-vibe">Vibe Score</div>
        <div class="nav-item" data-target="card-market">Market</div>
        <div class="nav-item" data-target="card-competitors">Competitors</div>
        <div class="nav-item" data-target="card-audience">Audience</div>
        <div class="nav-item" data-target="card-build">Build It</div>
        <div class="nav-item" data-target="card-ship">Ship It</div>
        <div class="nav-item" data-target="card-reddit">Community</div>
        <div class="nav-item" data-target="card-win">How to Win</div>
      </nav>

      <!-- Main content -->
      <div class="results-content">
        <div class="results-grid">

          <!-- 1. Vibe Score (full width) -->
          <div class="result-card vibe-hero" id="card-vibe">
            <div class="card-header">
              <div class="card-icon icon-pink">‚óÜ</div>
              <div>
                <div class="card-title">Vibe Score</div>
                <div class="card-subtitle">Overall opportunity assessment</div>
              </div>
            </div>
            <div class="card-body" id="body-vibe">
              <div class="skeleton" style="height:90px"></div>
            </div>
          </div>

          <!-- 2. Market Overview (full width) -->
          <div class="result-card full" id="card-market">
            <div class="card-header">
              <div class="card-icon icon-purple">‚óé</div>
              <div>
                <div class="card-title">Market Overview</div>
                <div class="card-subtitle">Saturation &amp; landscape</div>
              </div>
            </div>
            <div class="card-body" id="body-market">
              <div class="skeleton" style="height:50px;margin-bottom:10px"></div>
              <div class="skeleton" style="height:60px"></div>
            </div>
          </div>

          <!-- 3. Competitors (full width) -->
          <div class="result-card full" id="card-competitors">
            <div class="card-header">
              <div class="card-icon icon-red">‚óâ</div>
              <div>
                <div class="card-title">Competitors</div>
                <div class="card-subtitle">Who's already in the space</div>
              </div>
            </div>
            <div class="card-body" id="body-competitors">
              <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px">
                <div class="skeleton" style="height:90px"></div>
                <div class="skeleton" style="height:90px"></div>
                <div class="skeleton" style="height:90px"></div>
              </div>
            </div>
          </div>

          <!-- 4a. Audience & Revenue (half) -->
          <div class="result-card" id="card-audience">
            <div class="card-header">
              <div class="card-icon icon-cyan">‚óà</div>
              <div>
                <div class="card-title">Audience &amp; Revenue</div>
                <div class="card-subtitle">Who pays and how</div>
              </div>
            </div>
            <div class="card-body" id="body-audience">
              <div class="skeleton" style="height:80px;margin-bottom:10px"></div>
              <div class="skeleton" style="height:80px"></div>
            </div>
          </div>

          <!-- 4b. Build It (half) -->
          <div class="result-card" id="card-build">
            <div class="card-header">
              <div class="card-icon icon-yellow">‚óß</div>
              <div>
                <div class="card-title">Build It</div>
                <div class="card-subtitle">Difficulty, time &amp; stack</div>
              </div>
            </div>
            <div class="card-body" id="body-build">
              <div class="skeleton" style="height:70px;margin-bottom:10px"></div>
              <div class="skeleton" style="height:80px"></div>
            </div>
          </div>

          <!-- 5. Ship It (full width) -->
          <div class="result-card full" id="card-ship">
            <div class="card-header">
              <div class="card-icon icon-green">‚ñ≤</div>
              <div>
                <div class="card-title">Ship It</div>
                <div class="card-subtitle">Where to deploy first</div>
              </div>
            </div>
            <div class="card-body" id="body-ship">
              <div class="skeleton" style="height:70px;margin-bottom:10px"></div>
              <div class="skeleton" style="height:90px"></div>
            </div>
          </div>

          <!-- 6. Community Pulse (full width) -->
          <div class="result-card full" id="card-reddit">
            <div class="card-header">
              <div class="card-icon icon-purple">‚óê</div>
              <div>
                <div class="card-title">Community Pulse</div>
                <div class="card-subtitle">What real users say about existing solutions</div>
              </div>
            </div>
            <div class="card-body" id="body-reddit">
              <div class="skeleton" style="height:50px;margin-bottom:8px"></div>
              <div class="skeleton" style="height:50px;margin-bottom:8px"></div>
              <div class="skeleton" style="height:50px"></div>
            </div>
          </div>

          <!-- 7. How to Win (full width) -->
          <div class="result-card full" id="card-win">
            <div class="card-header">
              <div class="card-icon icon-pink">‚óá</div>
              <div>
                <div class="card-title">How to Win</div>
                <div class="card-subtitle">Top differentiators &amp; improvements</div>
              </div>
            </div>
            <div class="card-body" id="body-win">
              <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px">
                <div class="skeleton" style="height:80px"></div>
                <div class="skeleton" style="height:80px"></div>
                <div class="skeleton" style="height:80px"></div>
              </div>
            </div>
          </div>

        </div><!-- /results-grid -->

        <!-- Share + New Analysis -->
        <div class="action-row" id="action-row" style="display:none">
          <button class="share-btn" id="share-btn" onclick="shareResult()">Share Result ‚Üó</button>
          <button class="analyze-btn secondary" onclick="resetApp()">‚Üê New Analysis</button>
        </div>

      </div><!-- /results-content -->
    </div><!-- /results-layout -->

  </section>

</main>

<button class="version-badge" onclick="openChangelog()">v1.4</button>

<div class="changelog-overlay hidden" id="changelog-overlay" onclick="if(event.target===this)closeChangelog()">
  <div class="changelog-modal">
    <h3>What's New <button class="changelog-close" onclick="closeChangelog()">√ó</button></h3>
    <div class="changelog-entry">
      <div class="changelog-ver">v1.4 &mdash; Feb 20, 2026</div>
      <div class="changelog-desc">Web3 button, skill-level-first layout, sticky section nav, shareable result links, Community Pulse replaces Reddit, Build It shows your time only, How to Win focused.</div>
    </div>
    <div class="changelog-entry">
      <div class="changelog-ver">v1.3 &mdash; Feb 20, 2026</div>
      <div class="changelog-desc">Redesigned results header, full idea as title, consistent type hierarchy, reduced emoji, cleaner card icons.</div>
    </div>
    <div class="changelog-entry">
      <div class="changelog-ver">v1.2 &mdash; Feb 20, 2026</div>
      <div class="changelog-desc">Replaced skill slider with segmented control.</div>
    </div>
    <div class="changelog-entry">
      <div class="changelog-ver">v1.1 &mdash; Feb 20, 2026</div>
      <div class="changelog-desc">Consolidated cards, Reddit quotes view, How to Win section.</div>
    </div>
    <div class="changelog-entry">
      <div class="changelog-ver">v1.0 &mdash; Feb 20, 2026</div>
      <div class="changelog-desc">Initial launch.</div>
    </div>
  </div>
</div>

<script>
// ‚îÄ‚îÄ SKILL SELECTOR ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const SKILLS = [
  { key: 'vibe_coder',   label: 'Vibe Coder' },
  { key: 'beginner',     label: 'Beginner' },
  { key: 'intermediate', label: 'Intermediate' },
  { key: 'senior',       label: 'Senior Dev' },
];
let selectedSkill = 'beginner';
function selectSkill(idx) {
  selectedSkill = SKILLS[idx].key;
  document.querySelectorAll('.seg-btn').forEach((b,i)=>b.classList.toggle('active',i===idx));
}

// ‚îÄ‚îÄ HELPERS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const scoreColor = s => s>=8?'var(--green)':s>=6?'var(--yellow)':s>=4?'var(--purple)':'var(--red)';
const diffColor  = s => s<=3?'var(--green)':s<=5?'var(--yellow)':s<=7?'var(--purple)':'var(--red)';
const fmtScore   = n => Math.max(1,Math.min(10,parseInt(n)||5));
const trendIcon  = {rapidly_growing:'‚Üë‚Üë',growing:'‚Üë',stable:'‚Üí',declining:'‚Üì',emerging:'‚óé'};
const recLevel   = l => l==='highly_recommended'?'high':l==='recommended'?'med':'low';
const recLabel   = l => ({highly_recommended:'Top pick',recommended:'Good fit',possible:'Possible',not_recommended:'Skip'}[l]||l);
const platEmoji  = p=>({'web_app':'üåê','mobile_ios':'üì±','mobile_android':'üì±','mobile_cross_platform':'üì±','chrome_extension':'üîå','shopify_app':'üõç','wordpress_plugin':'üìù','desktop_mac':'üñ•','desktop_windows':'üñ•','desktop_cross_platform':'üñ•','api_service':'‚öô','slack_app':'üí¨','vs_code_extension':'‚å®','notion_integration':'üìì'}[p]||'üåê');
const priorityPill = p => p==='high'?'<span class="pill pill-red">High priority</span>':p==='medium'?'<span class="pill pill-yellow">Medium</span>':'<span class="pill pill-muted">Low</span>';

function diffRing(score, color) {
  const r=27,cx=34,cy=34,circ=2*Math.PI*r,pct=score/10;
  return `<div class="diff-ring">
    <svg width="68" height="68" viewBox="0 0 68 68">
      <circle cx="${cx}" cy="${cy}" r="${r}" fill="none" stroke="var(--subtle)" stroke-width="5"/>
      <circle cx="${cx}" cy="${cy}" r="${r}" fill="none" stroke="${color}" stroke-width="5"
        stroke-dasharray="${circ}" stroke-dashoffset="${circ*(1-pct)}" stroke-linecap="round"/>
    </svg>
    <div class="diff-ring-text"><strong style="color:${color}">${score}</strong><span>/10</span></div>
  </div>`;
}

const existInfo = e=>({
  fully_exists:    {label:'Already exists',   color:'var(--red)',   dot:'var(--red)',   bg:'rgba(239,68,68,0.07)'},
  mostly_exists:   {label:'Mostly exists',    color:'var(--yellow)',dot:'var(--yellow)',bg:'rgba(245,158,11,0.07)'},
  partially_exists:{label:'Partially exists', color:'var(--yellow)',dot:'var(--yellow)',bg:'rgba(245,158,11,0.07)'},
  significant_gap: {label:'Significant gap',  color:'var(--cyan)',  dot:'var(--cyan)',  bg:'rgba(6,182,212,0.07)'},
  blue_ocean:      {label:'Blue ocean',       color:'var(--green)', dot:'var(--green)', bg:'rgba(16,185,129,0.07)'},
}[e]||{label:e||'Unknown',color:'var(--muted)',dot:'var(--muted)',bg:'var(--subtle)'});

function makeVisible(id){document.getElementById(id)?.classList.add('visible');}

let _marketData=null, _opportunityData=null, _currentResultId=null;

// ‚îÄ‚îÄ VIBE SCORE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function renderVibeScore(){
  if(!_opportunityData) return;
  const d=_opportunityData, score=fmtScore(d.opportunity_score), color=scoreColor(score);
  document.getElementById('body-vibe').innerHTML=`
    <div class="vibe-layout">
      <div class="vibe-grade-block">
        <div class="vibe-grade">${d.opportunity_grade||'?'}</div>
        <div class="vibe-score-num">${score} / 10</div>
      </div>
      <div class="vibe-content">
        <div class="vibe-summary">${d.opportunity_summary||''}</div>
        ${_marketData?.market_summary?`<div class="vibe-detail">${_marketData.market_summary}</div>`:''}
        <div class="vibe-pills">
          ${d.opportunity_type?`<span class="pill pill-purple">${d.opportunity_type.replace(/_/g,' ')}</span>`:''}
          ${d.trend?`<span class="pill pill-cyan">${trendIcon[d.trend]||''} ${d.trend.replace(/_/g,' ')}</span>`:''}
        </div>
        ${d.market_size?`<div class="vibe-detail" style="margin-top:10px;font-size:12px;">${d.market_size}</div>`:''}
      </div>
    </div>`;
  makeVisible('card-vibe');
}

// ‚îÄ‚îÄ MARKET ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function renderMarket(d){
  _marketData=d;
  const ei=existInfo(d.exists), sat=fmtScore(d.saturation_score);
  const satColor=sat>=8?'var(--red)':sat>=5?'var(--yellow)':'var(--green)';
  document.getElementById('body-market').innerHTML=`
    <div class="exists-badge" style="background:${ei.bg};color:${ei.color}">
      <div class="exists-dot" style="background:${ei.dot}"></div>${ei.label}
    </div>
    <div class="sat-block">
      <div class="sat-label"><span>Market saturation</span><strong style="color:${satColor}">${sat}/10</strong></div>
      <div class="sat-track"><div class="sat-fill" style="width:${sat*10}%;background:${satColor}"></div></div>
    </div>`;
  makeVisible('card-market');

  const comps=d.competitors||[];
  document.getElementById('body-competitors').innerHTML=comps.length
    ?`<div class="comp-grid">${comps.map(c=>`
        <div class="comp-card">
          <div class="comp-name">${c.url?`<a href="${c.url}" target="_blank" rel="noopener">${c.name} ‚Üó</a>`:c.name}
            ${c.pricing?`<span class="pill pill-muted comp-price">${c.pricing}</span>`:''}</div>
          <div class="comp-desc">${c.description||''}</div>
          ${(c.strengths||[]).slice(0,2).map(s=>`<div class="comp-sw-item"><span style="color:var(--green)">+</span>${s}</div>`).join('')}
          ${(c.weaknesses||[]).slice(0,2).map(w=>`<div class="comp-sw-item"><span style="color:var(--red)">‚àí</span>${w}</div>`).join('')}
        </div>`).join('')}</div>`
    :'<p style="color:var(--muted);font-size:13px">No major competitors found ‚Äî possible blue ocean.</p>';
  makeVisible('card-competitors');
  renderVibeScore(); renderHowToWin();
}

// ‚îÄ‚îÄ AUDIENCE & REVENUE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function renderAudience(d){
  const auds=d.target_audiences||[], revs=d.monetization_strategies||[];
  document.getElementById('body-audience').innerHTML=`
    ${auds.length?`<div class="sec-label">Audiences</div>
      ${auds.slice(0,3).map(a=>`<div class="aud-row"><div class="aud-main">
        <strong>${a.segment||a}</strong>
        ${a.size||a.willingness_to_pay?`<span>${[a.size,a.willingness_to_pay?'Pays: '+a.willingness_to_pay:''].filter(Boolean).join(' ¬∑ ')}</span>`:''}
      </div></div>`).join('')}`:''}
    ${revs.length?`<div class="sec-label">Revenue models</div>
      ${revs.slice(0,3).map(m=>`<div class="rev-row">
        <div><div class="rev-model">${m.model}</div>${m.description?`<div class="rev-desc">${m.description}</div>`:''}</div>
        ${m.revenue_potential?`<span class="pill pill-green">${m.revenue_potential}</span>`:''}
      </div>`).join('')}`:''}`;
  makeVisible('card-audience');
}

// ‚îÄ‚îÄ BUILD IT (selected skill only) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function renderBuild(d){
  const score=fmtScore(d.difficulty_score),color=diffColor(score);
  const dlLabel={no_code:'No-code',beginner:'Beginner',intermediate:'Intermediate',advanced:'Advanced',expert:'Expert'}[d.difficulty]||d.difficulty||'?';
  const t=d.time_estimates||{};
  const skillTimeKey={vibe_coder:'vibe_coder',beginner:'beginner',intermediate:'intermediate',senior:'senior_dev'}[selectedSkill]||'beginner';
  const selectedTime=t[skillTimeKey];
  const skillLabel=SKILLS.find(s=>s.key===selectedSkill)?.label||'You';
  const stack=d.tech_stack||{};
  const stackItems=[{l:'Frontend',v:stack.frontend},{l:'Backend',v:stack.backend},{l:'Database',v:stack.database},{l:'Hosting',v:stack.hosting}].filter(s=>s.v);
  document.getElementById('body-build').innerHTML=`
    <div class="diff-display">
      ${diffRing(score,color)}
      <div><strong style="font-size:15px;color:${color}">${dlLabel}</strong>
        <p style="font-size:12px;color:var(--muted);margin-top:4px;line-height:1.5">${d.technical_summary||''}</p></div>
    </div>
    ${selectedTime?`<div class="sec-label">Your build time</div>
      <div class="data-block" style="display:flex;align-items:center;justify-content:space-between;padding:16px">
        <small style="font-size:12px;color:var(--muted);font-weight:600;text-transform:none;letter-spacing:0">${skillLabel}</small>
        <strong style="font-size:22px;font-weight:800;color:${color}">${selectedTime}</strong>
      </div>`:''}
    ${stackItems.length?`<div class="sec-label">Stack</div><div class="two-col">${stackItems.map(s=>`<div class="data-block"><small>${s.l}</small><span>${s.v}</span></div>`).join('')}</div>`:''}
    ${(d.required_apis||[]).length?`<div class="sec-label">Key APIs</div>${d.required_apis.slice(0,3).map(a=>`<div class="item-row"><div class="item-body"><strong>${a.url?`<a href="${a.url}" target="_blank" style="color:var(--text);text-decoration:none">${a.name} ‚Üó</a>`:a.name}</strong><span>${a.cost||''}</span></div></div>`).join('')}`:''}`;
  makeVisible('card-build');
}

// ‚îÄ‚îÄ SHIP IT ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function renderShip(d){
  const primary=d.primary_recommendation||'web_app';
  const opts=(d.deployment_options||[]).filter(o=>o.recommendation_level!=='not_recommended').slice(0,4);
  document.getElementById('body-ship').innerHTML=`
    <div class="plat-hero">
      <div class="plat-emoji">${platEmoji(primary)}</div>
      <div><div class="plat-name">${primary.replace(/_/g,' ').replace(/\b\w/g,l=>l.toUpperCase())}</div>
        <div class="plat-reason">${d.quick_win_approach||d.reasoning||''}</div></div>
    </div>
    ${opts.length?`<div class="plat-list">${opts.map(o=>`
      <div class="plat-row ${recLevel(o.recommendation_level)}">
        <div style="font-size:13px">${platEmoji(o.platform?.toLowerCase().replace(/\s+/g,'_'))}</div>
        <div class="plat-name-txt">${o.platform}</div>
        <div class="plat-meta">${o.time_to_market||''}</div>
        <span class="pill ${recLevel(o.recommendation_level)==='high'?'pill-green':recLevel(o.recommendation_level)==='med'?'pill-yellow':'pill-muted'}">${recLabel(o.recommendation_level)}</span>
      </div>`).join('')}</div>`:''}`;
  makeVisible('card-ship');
}

// ‚îÄ‚îÄ COMMUNITY PULSE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function renderSentiment(d){
  const insights=d.community_insights||[];
  if(!insights.length){
    document.getElementById('body-reddit').innerHTML='<p style="color:var(--muted);font-size:13px">No community discussions found for this topic yet.</p>';
    makeVisible('card-reddit'); return;
  }
  const pain   = insights.filter(i=>i.sentiment==='pain_point');
  const loved  = insights.filter(i=>i.sentiment==='loved_feature');
  const wishes = insights.filter(i=>i.sentiment==='wish');

  const col=(items,color,label,icon)=>items.length?`
    <div>
      <div class="sentiment-col-label" style="color:${color}">${icon} ${label}</div>
      ${items.map(i=>`
        <div class="sentiment-item" style="border-left-color:${color}">
          <div class="sentiment-quote">"${i.quote}"</div>
          <div class="sentiment-meta">${[i.source,i.theme].filter(Boolean).join(' ¬∑ ')}</div>
        </div>`).join('')}
    </div>`:'' ;

  document.getElementById('body-reddit').innerHTML=`
    <div class="sentiment-cols">
      ${col(pain,  'var(--red)',    'Pain Points',    '‚ö°')}
      ${col(loved, 'var(--green)',  'What They Love', '‚òÖ')}
      ${col(wishes,'var(--purple)', 'Wish List',      '‚óé')}
    </div>`;
  makeVisible('card-reddit');
}

// ‚îÄ‚îÄ HOW TO WIN (filtered, priority only) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function renderHowToWin(){
  const diffs=_marketData?.key_differentiators_needed||[];
  const imps=_opportunityData?.improvement_suggestions||[];
  if(!diffs.length&&!imps.length) return;

  const highImps=imps.filter(i=>i.priority==='high').slice(0,2);
  const medImps =imps.filter(i=>i.priority==='medium').slice(0,2);

  document.getElementById('body-win').innerHTML=`<div class="win-grid">
    ${diffs.slice(0,2).map(d=>`
      <div class="win-card">
        <div class="win-card-label">Differentiator</div>
        <div class="win-card-title">${d}</div>
      </div>`).join('')}
    ${[...highImps,...medImps].map(i=>`
      <div class="win-card">
        <div class="win-card-label">Improvement</div>
        <div class="win-card-title">${i.suggestion}</div>
        <div class="win-card-reason">${i.reasoning||''}</div>
        <div class="win-badges">${priorityPill(i.priority)}</div>
      </div>`).join('')}
  </div>`;
  makeVisible('card-win');
}

// ‚îÄ‚îÄ PROGRESS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function setStep(phase,state){
  const el=document.getElementById(`step-${phase}`);
  if(!el)return; el.classList.remove('active','done'); el.classList.add(state);
}
function setProgressMsg(msg){const el=document.getElementById('progress-message');if(el)el.innerHTML=msg;}

// ‚îÄ‚îÄ SIDEBAR NAV ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
let navObserver=null;
function setupNavObserver(){
  if(navObserver)navObserver.disconnect();
  navObserver=new IntersectionObserver(entries=>{
    entries.forEach(entry=>{
      if(entry.isIntersecting){
        document.querySelectorAll('.nav-item').forEach(n=>n.classList.remove('active'));
        const item=document.querySelector(`.nav-item[data-target="${entry.target.id}"]`);
        if(item)item.classList.add('active');
      }
    });
  },{rootMargin:'-15% 0px -70% 0px'});
  document.querySelectorAll('.result-card').forEach(c=>navObserver.observe(c));
}

document.querySelectorAll('.nav-item').forEach(item=>{
  item.addEventListener('click',()=>{
    const t=document.getElementById(item.dataset.target);
    if(t)t.scrollIntoView({behavior:'smooth',block:'start'});
  });
});

// ‚îÄ‚îÄ EVENT HANDLER ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function handleEvent(event,data){
  switch(event){
    case 'status':      setProgressMsg(data.message); if(data.phase)setStep(data.phase,'active'); break;
    case 'market':      setStep('market','done');      renderMarket(data); break;
    case 'technical':   setStep('technical','done');   renderBuild(data);  break;
    case 'opportunity': setStep('opportunity','done'); _opportunityData=data; renderVibeScore(); renderAudience(data); renderHowToWin(); break;
    case 'deployment':  setStep('deployment','done');  renderShip(data);   break;
    case 'sentiment':   setStep('sentiment','done');   renderSentiment(data); break;
    case 'complete': {
      if(data.resultId){
        _currentResultId=data.resultId;
        history.replaceState(null,'',`?r=${data.resultId}`);
      }
      document.getElementById('results-eyebrow').textContent='Analyzed';
      document.getElementById('action-row').style.display='flex';
      const prog=document.getElementById('progress-section');
      prog.style.transition='opacity 0.6s'; prog.style.opacity='0';
      setTimeout(()=>prog.style.display='none',700);
      break;
    }
    case 'error': setProgressMsg(`Error: ${data.message}`); break;
  }
}

// ‚îÄ‚îÄ SHARE RESULT ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function shareResult(){
  const url=_currentResultId?`${window.location.origin}/?r=${_currentResultId}`:window.location.href;
  navigator.clipboard.writeText(url).then(()=>{
    const btn=document.getElementById('share-btn');
    const orig=btn.textContent;
    btn.textContent='Link copied!';
    btn.style.color='var(--green)'; btn.style.borderColor='var(--green)';
    setTimeout(()=>{btn.textContent=orig;btn.style.color='';btn.style.borderColor='';},2500);
  }).catch(()=>prompt('Copy this link:',url));
}

// ‚îÄ‚îÄ LOAD SHARED RESULT ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function loadSharedResult(id){
  document.getElementById('input-section').style.display='none';
  document.getElementById('results-section').style.display='block';
  document.getElementById('results-eyebrow').textContent='Loading...';
  try{
    const res=await fetch(`/api/result/${id}`);
    if(!res.ok)throw new Error('Not found');
    const data=await res.json();
    document.getElementById('results-idea').textContent=data.idea||'Shared result';
    document.getElementById('results-eyebrow').textContent='Analyzed';
    _currentResultId=id;
    if(data.skillLevel){const idx=SKILLS.findIndex(s=>s.key===data.skillLevel);if(idx>=0)selectSkill(idx);}
    _marketData=null; _opportunityData=null;
    if(data.market)    renderMarket(data.market);
    if(data.technical) renderBuild(data.technical);
    if(data.opportunity){_opportunityData=data.opportunity;renderVibeScore();renderAudience(data.opportunity);renderHowToWin();}
    if(data.deployment) renderShip(data.deployment);
    if(data.sentiment)  renderSentiment(data.sentiment);
    document.getElementById('action-row').style.display='flex';
    setupNavObserver();
  }catch(err){
    document.getElementById('results-section').style.display='none';
    document.getElementById('input-section').style.display='';
    alert('Could not load shared result ‚Äî it may have expired.');
  }
}

// ‚îÄ‚îÄ MAIN FLOW ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function startAnalysis(){
  const idea=document.getElementById('idea-input').value.trim();
  if(!idea){
    document.getElementById('idea-input').style.borderColor='var(--red)';
    setTimeout(()=>document.getElementById('idea-input').style.borderColor='',2000);
    return;
  }
  _marketData=null; _opportunityData=null; _currentResultId=null;

  document.getElementById('results-idea').textContent=idea;
  document.getElementById('results-eyebrow').textContent='Analyzing...';
  document.getElementById('action-row').style.display='none';
  document.getElementById('input-section').style.display='none';
  document.getElementById('progress-section').style.display='block';
  document.getElementById('progress-section').style.opacity='1';
  document.getElementById('results-section').style.display='block';

  ['vibe','market','audience','competitors','build','ship','reddit','win'].forEach(id=>document.getElementById(`card-${id}`)?.classList.remove('visible'));
  ['market','technical','opportunity','deployment','sentiment'].forEach(s=>{const el=document.getElementById(`step-${s}`);if(el)el.classList.remove('active','done');});
  setProgressMsg('Spinning up research agents...');
  setupNavObserver();

  const response=await fetch('/api/analyze',{
    method:'POST',headers:{'Content-Type':'application/json'},
    body:JSON.stringify({idea,skillLevel:selectedSkill}),
  });
  if(!response.ok){alert('Server error: '+response.statusText);resetApp();return;}

  const reader=response.body.getReader(),decoder=new TextDecoder();
  let buffer='';
  while(true){
    const{done,value}=await reader.read();
    if(done)break;
    buffer+=decoder.decode(value,{stream:true});
    const parts=buffer.split('\n\n');buffer=parts.pop();
    for(const part of parts){
      if(!part.trim())continue;
      const lines=part.split('\n');
      let event='message',dataStr='';
      for(const line of lines){
        if(line.startsWith('event: '))event=line.slice(7).trim();
        if(line.startsWith('data: '))dataStr=line.slice(6).trim();
      }
      if(!dataStr)continue;
      let data;try{data=JSON.parse(dataStr);}catch{continue;}
      handleEvent(event,data);
    }
  }
}

function resetApp(){
  history.replaceState(null,'','/');
  document.getElementById('input-section').style.display='';
  document.getElementById('progress-section').style.display='none';
  document.getElementById('results-section').style.display='none';
  document.getElementById('action-row').style.display='none';
  document.getElementById('idea-input').value='';
  if(navObserver)navObserver.disconnect();
}

function openChangelog(){document.getElementById('changelog-overlay').classList.remove('hidden');}
function closeChangelog(){document.getElementById('changelog-overlay').classList.add('hidden');}

document.getElementById('idea-input').addEventListener('keydown',e=>{
  if(e.key==='Enter'&&(e.metaKey||e.ctrlKey))startAnalysis();
});

// ‚îÄ‚îÄ CHECK FOR SHARED RESULT ON LOAD ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const sharedId=new URLSearchParams(window.location.search).get('r');
if(sharedId)loadSharedResult(sharedId);
</script>
</body>
</html>
