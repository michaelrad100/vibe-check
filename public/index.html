<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Vibe Check — Is Your Idea Worth Building?</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Oswald:wght@400;500;700&display=swap" rel="stylesheet" />
  <style>
    :root {
      --bg-deep:     #050505;
      --bg-surface:  #0f0f11;
      --bg-card:     #141416;

      --accent-cyan:     #00e5ff;
      --accent-cyan-dim: rgba(0, 229, 255, 0.12);
      --accent-glow:     rgba(0, 229, 255, 0.08);

      --green:  #34d399;
      --yellow: #fbbf24;
      --red:    #f87171;

      --text-main:  #e0e0e0;
      --text-muted: #888888;
      --text-dark:  #000000;

      --border:           #262626;
      --border-highlight: #404040;

      --font-display: 'Oswald', sans-serif;
      --font-body:    'Inter', sans-serif;

      --sidebar-width: 200px;
      --sidebar-collapsed: 48px;
    }

    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      background-color: var(--bg-deep);
      color: var(--text-main);
      font-family: var(--font-body);
      font-size: 15px;
      line-height: 1.6;
      min-height: 100vh;
      overflow-x: hidden;
      -webkit-font-smoothing: antialiased;
    }

    /* ── VERSION CORNER (shared, always fixed) ─── */
    .version-corner {
      position: fixed;
      bottom: 32px;
      right: 32px;
      z-index: 500;
    }
    .version-badge {
      cursor: pointer;
      color: var(--accent-cyan);
      border: 1px solid rgba(0,229,255,0.25);
      padding: 3px 8px;
      font-size: 11px;
      font-family: var(--font-body);
      letter-spacing: 1px;
      text-transform: uppercase;
      transition: background 0.2s ease, border-color 0.2s ease;
      user-select: none;
      display: inline-block;
    }
    .version-badge:hover {
      background: rgba(0,229,255,0.08);
      border-color: rgba(0,229,255,0.5);
    }
    .changelog-popover {
      display: none;
      position: fixed;
      bottom: calc(32px + 1.8em + 16px);
      right: 32px;
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-top: 2px solid var(--accent-cyan);
      min-width: 280px;
      padding: 20px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.6);
      z-index: 501;
    }
    .changelog-popover.open { display: block; }
    .changelog-header {
      font-family: var(--font-display);
      font-size: 11px;
      letter-spacing: 2px;
      text-transform: uppercase;
      color: var(--accent-cyan);
      margin-bottom: 16px;
    }
    .changelog-entry { margin-bottom: 12px; }
    .changelog-version {
      font-family: var(--font-display);
      font-size: 14px;
      font-weight: 700;
      color: var(--text-main);
      margin-bottom: 8px;
    }
    .changelog-date {
      font-family: var(--font-body);
      font-size: 11px;
      font-weight: 400;
      color: var(--text-muted);
      letter-spacing: 0.5px;
    }
    .changelog-list {
      list-style: none;
      display: flex;
      flex-direction: column;
      gap: 5px;
    }
    .changelog-list li {
      font-size: 12px;
      color: var(--text-muted);
      padding-left: 14px;
      position: relative;
      line-height: 1.5;
      text-transform: none;
      letter-spacing: 0;
    }
    .changelog-list li::before {
      content: '—';
      position: absolute;
      left: 0;
      color: var(--accent-cyan);
      opacity: 0.5;
    }

    /* ══════════════════════════════════════════════
       LANDING PAGE
    ══════════════════════════════════════════════ */
    #landing {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      padding: 0 20px 100px;
      position: relative;
    }
    #landing::before {
      content: '';
      position: fixed;
      top: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 100%;
      height: 100%;
      background: radial-gradient(circle at top center, var(--accent-glow) 0%, transparent 70%);
      pointer-events: none;
      z-index: 0;
    }

    .landing-inner {
      width: 100%;
      max-width: 800px;
      text-align: center;
      position: relative;
      z-index: 1;
    }

    .landing-h1 {
      font-family: var(--font-display);
      font-size: clamp(60px, 10vw, 84px);
      line-height: 0.95;
      text-transform: uppercase;
      font-weight: 700;
      margin-bottom: 24px;
      letter-spacing: -1px;
      color: var(--text-main);
    }

    .landing-sub {
      color: var(--text-muted);
      font-size: 18px;
      max-width: 540px;
      margin: 0 auto 64px;
      line-height: 1.6;
    }

    .form-card {
      background: var(--bg-card);
      border: 1px solid var(--border);
      padding: 40px;
      width: 100%;
      text-align: left;
      position: relative;
      box-shadow: 0 40px 100px rgba(0,0,0,0.5);
    }
    .form-card::after {
      content: '';
      position: absolute;
      top: 0; left: 0;
      width: 2px;
      height: 100%;
      background: var(--accent-cyan);
    }

    .field-label {
      display: block;
      font-family: var(--font-display);
      text-transform: uppercase;
      font-size: 13px;
      letter-spacing: 1px;
      color: var(--text-muted);
      margin-bottom: 12px;
    }

    .textarea-wrapper { position: relative; margin-bottom: 32px; }

    textarea {
      width: 100%;
      height: 180px;
      background: rgba(0,0,0,0.2);
      border: 1px solid var(--border);
      padding: 20px;
      color: var(--text-main);
      font-family: var(--font-body);
      font-size: 15px;
      resize: none;
      outline: none;
      transition: border-color 0.3s ease;
    }
    textarea::placeholder { color: #444; }
    textarea:focus { border-color: var(--accent-cyan); }

    .cta-button {
      width: 100%;
      background: var(--accent-cyan);
      color: var(--text-dark);
      border: none;
      padding: 20px;
      font-family: var(--font-display);
      font-size: 18px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 2px;
      cursor: pointer;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }
    .cta-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 30px rgba(0,229,255,0.3);
    }
    .cta-button:active { transform: translateY(0); }
    .cta-button:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }

    /* Skill selector */
    .skill-selector-row {
      margin-bottom: 24px;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    .skill-selector-label {
      font-family: var(--font-display);
      font-size: 11px;
      letter-spacing: 1.5px;
      text-transform: uppercase;
      color: var(--text-muted);
    }
    .skill-selector {
      display: flex;
      gap: 8px;
    }
    .skill-btn {
      flex: 1;
      padding: 10px 8px;
      background: transparent;
      border: 1px solid var(--border);
      color: var(--text-muted);
      font-family: var(--font-body);
      font-size: 13px;
      cursor: pointer;
      transition: all 0.15s;
      text-align: center;
      line-height: 1.3;
    }
    .skill-btn:hover {
      border-color: var(--border-highlight);
      color: var(--text-main);
    }
    .skill-btn.active {
      border-color: var(--accent-cyan);
      color: var(--accent-cyan);
      background: var(--accent-cyan-dim);
    }

    /* Mode selector */
    .mode-selector-row {
      margin-bottom: 28px;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    .mode-selector-label {
      font-family: var(--font-display);
      font-size: 11px;
      letter-spacing: 1.5px;
      text-transform: uppercase;
      color: var(--text-muted);
    }
    .mode-selector { display: flex; gap: 8px; }
    .mode-btn {
      flex: 1;
      padding: 14px 8px;
      background: transparent;
      border: 1px solid var(--border);
      color: var(--text-muted);
      font-family: var(--font-body);
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.15s;
      text-align: center;
      line-height: 1.3;
    }
    .mode-btn:hover { border-color: var(--border-highlight); color: var(--text-main); }
    .mode-btn.active { border-color: var(--accent-cyan); color: var(--accent-cyan); background: var(--accent-cyan-dim); }
    .mode-btn .mode-sub {
      display: block;
      font-size: 11px;
      color: var(--text-muted);
      margin-top: 3px;
      font-weight: 400;
    }
    .mode-btn.active .mode-sub { color: rgba(0,229,255,0.65); }

    /* ══════════════════════════════════════════════
       RESULTS PAGE
    ══════════════════════════════════════════════ */
    #results {
      display: none;
      min-height: 100vh;
    }

    /* Glow overlay for results */
    #results::before {
      content: '';
      position: fixed;
      top: -20%;
      left: 20%;
      width: 80%;
      height: 80%;
      background: radial-gradient(circle, var(--accent-glow) 0%, transparent 60%);
      pointer-events: none;
      z-index: 0;
    }

    /* Sidebar */
    .sidebar {
      width: var(--sidebar-collapsed);
      background: var(--bg-surface);
      border-right: 1px solid var(--border);
      height: 100vh;
      position: sticky;
      top: 0;
      display: flex;
      flex-direction: column;
      padding: 24px 0;
      z-index: 100;
      flex-shrink: 0;
      overflow: hidden;
      transition: width 0.22s ease;
    }
    .sidebar:hover {
      width: var(--sidebar-width);
    }

    /* Brand link — shows "VC" in cyan when collapsed, full name when expanded */
    .brand-link {
      padding: 0 0 24px;
      font-family: var(--font-display);
      font-size: 20px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 1px;
      color: var(--text-main);
      border-bottom: 1px solid var(--border);
      margin-bottom: 16px;
      text-decoration: none;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: color 0.2s ease;
      white-space: nowrap;
      overflow: hidden;
      position: relative;
    }
    /* Monogram shown when collapsed */
    .brand-link .brand-mono {
      font-family: var(--font-display);
      font-size: 16px;
      font-weight: 700;
      color: var(--accent-cyan);
      letter-spacing: 1px;
      flex-shrink: 0;
      transition: opacity 0.15s ease;
    }
    /* Full name shown when expanded */
    .brand-link .brand-full {
      position: absolute;
      left: 16px;
      opacity: 0;
      transition: opacity 0.15s ease 0.05s;
      pointer-events: none;
      color: var(--text-main);
    }
    .sidebar:hover .brand-link .brand-mono { opacity: 0; }
    .sidebar:hover .brand-link .brand-full { opacity: 1; }
    .sidebar:hover .brand-link { justify-content: flex-start; padding-left: 16px; }
    .brand-link:hover { color: var(--accent-cyan); }
    .sidebar:hover .brand-link:hover .brand-full { color: var(--accent-cyan); }

    .nav-menu { list-style: none; display: flex; flex-direction: column; gap: 4px; }
    .nav-item {
      padding: 10px 16px;
      font-size: 13px;
      font-weight: 500;
      color: var(--text-muted);
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      gap: 10px;
      border-left: 2px solid transparent;
      white-space: nowrap;
      overflow: hidden;
    }
    .nav-item:hover { color: var(--text-main); background: rgba(255,255,255,0.03); }
    .nav-item.active {
      color: var(--accent-cyan);
      border-left-color: var(--accent-cyan);
      background: linear-gradient(90deg, var(--accent-cyan-dim), transparent);
    }
    /* Nav label text — hidden when collapsed, visible when sidebar is hovered */
    .nav-label {
      opacity: 0;
      transition: opacity 0.15s ease 0.05s;
      pointer-events: none;
    }
    .sidebar:hover .nav-label { opacity: 1; }
    /* No dot indicators — clean when collapsed */
    .nav-item::before { display: none; }

    /* Hamburger button — mobile only */
    .sidebar-toggle {
      display: none;
      position: fixed;
      top: 16px;
      left: 16px;
      z-index: 200;
      background: var(--bg-card);
      border: 1px solid var(--border);
      color: var(--text-main);
      width: 36px;
      height: 36px;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-size: 18px;
      transition: color 0.2s ease;
    }
    .sidebar-toggle:hover { color: var(--accent-cyan); }

    /* Overlay behind mobile sidebar */
    .sidebar-overlay {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.6);
      z-index: 150;
    }

    @media (max-width: 768px) {
      .sidebar-toggle { display: flex; }
      .sidebar-overlay.visible { display: block; }
      .sidebar {
        position: fixed;
        top: 0;
        left: 0;
        height: 100vh;
        width: var(--sidebar-width) !important;
        transform: translateX(-100%);
        transition: transform 0.25s ease;
        z-index: 160;
      }
      .sidebar.open {
        transform: translateX(0);
      }
      .main-view {
        padding: 40px 20px 40px 20px;
      }
    }

    /* Main dashboard */
    .main-view {
      flex: 1;
      padding: 40px;
      z-index: 1;
      max-width: 1400px;
      margin: 0 auto;
      display: flex;
      flex-direction: column;
    }

    /* Results header / status */
    .results-header {
      margin-bottom: 24px;
    }
    .results-idea-title {
      font-family: var(--font-display);
      font-size: 28px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: -0.5px;
      color: var(--text-main);
      margin-bottom: 4px;
    }
    .results-idea-sub {
      font-size: 13px;
      color: var(--text-muted);
    }

    .status-bar {
      background: var(--bg-card);
      border: 1px solid var(--border);
      padding: 14px 20px;
      margin-bottom: 24px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .status-dot {
      width: 7px; height: 7px;
      border-radius: 50%;
      background: var(--accent-cyan);
      animation: pulse 1.2s infinite;
      flex-shrink: 0;
    }
    @keyframes pulse {
      0%, 100% { opacity: 1; transform: scale(1); }
      50%       { opacity: 0.4; transform: scale(0.8); }
    }
    .status-text { font-size: 13px; color: var(--text-muted); }

    .dashboard-grid {
      display: grid;
      grid-template-columns: repeat(12, 1fr);
      gap: 24px;
      grid-auto-rows: minmax(min-content, auto);
    }

    /* Cards */
    .section-card {
      background: var(--bg-card);
      border: 1px solid var(--border);
      position: relative;
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }
    .section-header {
      font-family: var(--font-display);
      text-transform: uppercase;
      letter-spacing: 1px;
      font-size: 13px;
      color: var(--text-muted);
      margin-bottom: 16px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .section-badge {
      font-family: var(--font-body);
      font-size: 11px;
      font-weight: 600;
      padding: 2px 8px;
      border: 1px solid var(--border-highlight);
      color: var(--text-muted);
      text-transform: none;
      letter-spacing: 0;
    }

    /* Skeleton loader */
    .skeleton {
      background: linear-gradient(90deg, var(--bg-surface) 25%, #1a1a1e 50%, var(--bg-surface) 75%);
      background-size: 200% 100%;
      animation: shimmer 1.5s infinite;
    }
    @keyframes shimmer {
      0%   { background-position: 200% 0; }
      100% { background-position: -200% 0; }
    }
    .skel-block { height: 20px; margin-bottom: 8px; border-radius: 2px; }

    /* ── Score card ── */
    .card-score {
      grid-column: span 12;
      background: linear-gradient(180deg, var(--bg-card) 0%, #0a0a0a 100%);
      padding: 40px;
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      align-items: center;
      border-top: 2px solid var(--accent-cyan);
      scroll-margin-top: 24px;
    }
    .score-left { grid-column: 1; }
    .score-left h2 {
      font-family: var(--font-display);
      font-size: 36px;
      line-height: 1.1;
      text-transform: uppercase;
      margin-bottom: 12px;
      color: var(--text-main);
    }
    .score-left p { color: var(--text-muted); max-width: 240px; font-size: 13px; line-height: 1.6; }

    .score-visual {
      grid-column: 2;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }
    .grade-ring {
      width: 200px; height: 200px;
      border-radius: 50%;
      border: 2px solid var(--border);
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      box-shadow: 0 0 60px rgba(0,229,255,0.08);
    }
    .grade-ring::after {
      content: '';
      position: absolute;
      top: -2px; left: -2px; right: -2px; bottom: -2px;
      border-radius: 50%;
      border: 2px solid transparent;
      border-top-color: var(--accent-cyan);
      border-right-color: var(--accent-cyan);
      transform: rotate(-45deg);
    }
    .grade-value {
      font-family: var(--font-display);
      font-size: 120px;
      line-height: 1;
      font-weight: 700;
      color: var(--text-main);
    }
    .score-meta {
      text-align: center;
      margin-top: 16px;
      font-family: var(--font-display);
      text-transform: uppercase;
      letter-spacing: 2px;
      color: var(--accent-cyan);
      font-size: 13px;
    }
    .score-stats {
      grid-column: 3;
      display: flex;
      flex-direction: column;
      gap: 24px;
      padding-left: 40px;
      border-left: 1px solid var(--border);
    }
    .stat-row label {
      display: block;
      font-size: 12px;
      text-transform: uppercase;
      color: var(--text-muted);
      margin-bottom: 4px;
    }
    .stat-row .value {
      font-family: var(--font-display);
      font-size: 24px;
      color: var(--text-main);
      font-weight: 500;
    }
    .value-cyan  { color: var(--accent-cyan) !important; }
    .value-green { color: var(--green) !important; }
    .value-yellow{ color: var(--yellow) !important; }
    .value-red   { color: var(--yellow) !important; }

    /* ── Market card ── */
    .card-market {
      grid-column: span 8;
      padding: 28px;
      display: grid;
      grid-template-columns: 160px 1fr;
      gap: 28px;
      scroll-margin-top: 24px;
    }
    /* Left column: vertical saturation meter */
    .market-visual-col {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 12px;
    }
    .market-status-label {
      font-family: var(--font-display);
      font-size: 15px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      color: var(--text-main);
      text-align: center;
      line-height: 1.2;
    }
    .market-status-sub {
      font-size: 11px;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.8px;
      text-align: center;
      margin-top: -6px;
      margin-bottom: 4px;
    }
    .sat-meter {
      flex: 1;
      width: 36px;
      background: rgba(255,255,255,0.05);
      border: 1px solid var(--border);
      position: relative;
      min-height: 100px;
    }
    .sat-meter-fill {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      background: var(--accent-cyan);
      transition: height 0.8s ease;
    }
    .sat-score-row {
      display: flex;
      align-items: baseline;
      gap: 2px;
    }
    .sat-score-num {
      font-family: var(--font-display);
      font-size: 32px;
      font-weight: 700;
      color: var(--accent-cyan);
      line-height: 1;
    }
    .sat-score-denom {
      font-size: 13px;
      color: var(--text-muted);
    }
    .sat-score-label {
      font-size: 10px;
      text-transform: uppercase;
      letter-spacing: 0.8px;
      color: var(--text-muted);
    }

    /* Right column: data */
    .market-data-col {
      display: flex;
      flex-direction: column;
      gap: 20px;
      justify-content: center;
    }
    .data-point { border-left: 1px solid var(--border-highlight); padding-left: 16px; }
    .data-point h4 { font-family: var(--font-display); font-size: 20px; margin-bottom: 4px; color: var(--text-main); }
    .data-point p  { font-size: 12px; color: var(--text-muted); }

    /* Saturation bar (legacy — kept for reset compatibility) */
    .sat-bar-wrap { display: none; }
    .sat-bar-bg { flex: 1; height: 3px; background: rgba(0,0,0,0.3); }
    .sat-bar-fill { height: 100%; background: var(--accent-cyan); transition: width 0.6s ease; }
    .sat-bar-label { font-size: 11px; color: rgba(0,0,0,0.6); white-space: nowrap; font-weight: 600; }

    /* Differentiator tags */
    .diff-tags { display: flex; flex-wrap: wrap; gap: 6px; margin-top: 4px; }
    .diff-tag {
      font-size: 10px;
      padding: 2px 8px;
      border: 1px solid var(--border-highlight);
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    /* ── Audience card ── */
    .card-audience {
      grid-column: span 4;
      padding: 24px;
      display: flex;
      flex-direction: column;
      gap: 12px;
      scroll-margin-top: 24px;
    }
    .segment-block {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: rgba(255,255,255,0.03);
      padding: 12px;
      border-left: 2px solid var(--border-highlight);
    }
    .segment-block.primary {
      border-left-color: var(--accent-cyan);
      background: linear-gradient(90deg, var(--accent-cyan-dim), transparent);
    }
    .segment-name { font-family: var(--font-display); text-transform: uppercase; font-size: 14px; letter-spacing: 0.5px; }
    .segment-val  { font-size: 12px; color: var(--text-muted); }

    /* Monetization inside audience */
    .mono-row {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-top: 4px;
      padding-top: 12px;
      border-top: 1px solid var(--border);
    }
    .mono-item {
      background: rgba(255,255,255,0.02);
      border: 1px solid var(--border);
      padding: 10px 12px;
    }
    .mono-model { font-size: 12px; font-weight: 600; color: var(--text-main); margin-bottom: 2px; }
    .mono-potential { font-size: 10px; color: var(--accent-cyan); text-transform: uppercase; letter-spacing: 0.5px; }

    /* ── Competitors card ── */
    .card-competitors {
      grid-column: span 12;
      padding: 24px;
      scroll-margin-top: 24px;
    }
    .comp-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 16px;
      margin-top: 16px;
    }
    .comp-tile {
      background: #000;
      border: 1px solid var(--border);
      padding: 16px;
      position: relative;
      transition: border-color 0.2s;
    }
    .comp-tile:hover { border-color: var(--accent-cyan); }
    .comp-logo-hidden {
      display: none;
    }
    .comp-logo {
      width: 32px; height: 32px;
      background: #1a1a1a;
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 10px;
      color: var(--text-muted);
    }
    .comp-name { font-family: var(--font-display); font-size: 22px; text-transform: uppercase; margin-bottom: 8px; color: var(--text-main); text-decoration: none; display: block; transition: color 0.2s ease; }
    a.comp-name:hover { color: var(--accent-cyan); }
    .comp-desc { font-size: 13px; color: var(--text-muted); margin-bottom: 8px; line-height: 1.5; }
    .comp-meta { font-size: 11px; color: var(--text-muted); display: flex; justify-content: space-between; margin-bottom: 4px; }
    .comp-meta span:first-child { text-transform: uppercase; letter-spacing: 0.5px; }
    .strength-bar { height: 2px; background: #222; width: 100%; margin-top: 8px; }
    .strength-fill { height: 100%; background: var(--accent-cyan); transition: width 0.6s ease; }
    .sw-row { display: flex; gap: 4px; flex-wrap: wrap; margin-top: 8px; }
    .sw-tag { font-size: 12px; padding: 2px 6px; }
    .sw-strength { background: rgba(52,211,153,0.1); color: var(--green); }
    .sw-weakness { background: rgba(251,191,36,0.1); color: var(--yellow); }

    /* ── Build card ── */
    .card-build {
      grid-column: span 6;
      padding: 24px;
      scroll-margin-top: 24px;
    }
    .time-lockup {
      font-family: var(--font-display);
      font-size: 56px;
      line-height: 1;
      font-weight: 700;
      color: var(--text-main);
      margin-bottom: 8px;
    }
    .time-lockup span {
      display: block;
      font-size: 12px;
      font-weight: 400;
      color: var(--accent-cyan);
      letter-spacing: 2px;
      text-transform: uppercase;
      margin-bottom: 4px;
    }
    .build-summary { font-size: 12px; color: var(--text-muted); line-height: 1.6; margin-bottom: 16px; }
    .tech-stack { display: flex; gap: 8px; flex-wrap: wrap; margin-top: 12px; }
    .tech-badge {
      border: 1px solid var(--border);
      padding: 6px 12px;
      font-size: 11px;
      text-transform: uppercase;
      color: var(--text-muted);
      letter-spacing: 0.5px;
    }

    /* ── Ship It card ── */
    .card-ship {
      grid-column: span 6;
      padding: 24px;
      scroll-margin-top: 24px;
    }
    .deploy-list { display: flex; flex-direction: column; gap: 8px; margin-top: 8px; }
    .deploy-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: rgba(255,255,255,0.02);
      border: 1px solid var(--border);
      padding: 10px 14px;
    }
    .deploy-platform { font-size: 13px; font-weight: 600; color: var(--text-main); }
    .deploy-reason { font-size: 12px; color: var(--text-muted); margin-top: 2px; }
    .deploy-time { font-size: 11px; color: var(--text-muted); white-space: nowrap; margin-left: 12px; flex-shrink: 0; }
    .rec-pill {
      font-size: 10px;
      font-weight: 600;
      padding: 2px 6px;
      border: 1px solid;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      white-space: nowrap;
    }
    .rec-green  { color: var(--green);  border-color: rgba(52,211,153,0.3);  background: rgba(52,211,153,0.08); }
    .rec-cyan   { color: var(--accent-cyan); border-color: rgba(0,229,255,0.3); background: rgba(0,229,255,0.06); }
    .rec-yellow { color: var(--yellow); border-color: rgba(251,191,36,0.3);  background: rgba(251,191,36,0.06); }
    .rec-red    { color: var(--yellow); border-color: rgba(251,191,36,0.3);  background: rgba(251,191,36,0.06); }

    /* ── Community Pulse card ── */
    .card-community {
      grid-column: span 12;
      padding: 24px;
      scroll-margin-top: 24px;
    }
    .pulse-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 24px;
      margin-top: 16px;
    }
    .pulse-col-header {
      font-family: var(--font-display);
      font-size: 11px;
      letter-spacing: 1.5px;
      text-transform: uppercase;
      color: var(--text-muted);
      margin-bottom: 12px;
      padding-bottom: 8px;
      border-bottom: 1px solid var(--border);
    }
    .pulse-col-header.pain   { color: var(--accent-cyan); border-color: var(--accent-cyan); }
    .pulse-col-header.love   { color: var(--green);  border-color: var(--green); }
    .pulse-col-header.wish   { color: var(--yellow); border-color: var(--yellow); }

    .pulse-items { display: flex; flex-direction: column; gap: 12px; }
    .pulse-item {
      border-left: 3px solid var(--border-highlight);
      padding: 12px 14px;
      background: rgba(255,255,255,0.02);
    }
    .pulse-item.pain { border-left-color: var(--accent-cyan); }
    .pulse-item.love { border-left-color: var(--green); }
    .pulse-item.wish { border-left-color: var(--yellow); }

    .pulse-quote {
      font-size: 14px;
      color: var(--text-main);
      font-style: italic;
      line-height: 1.6;
      margin-bottom: 10px;
    }
    .pulse-meta { display: flex; flex-wrap: wrap; align-items: center; gap: 6px; }
    .pulse-theme {
      font-size: 11px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      color: var(--text-muted);
    }
    .pulse-source {
      font-size: 11px;
      color: var(--border-highlight);
    }
    .pulse-source a {
      color: var(--accent-cyan);
      text-decoration: none;
    }
    .pulse-source a:hover { text-decoration: underline; }
    .pulse-competitor {
      font-size: 11px;
      padding: 1px 6px;
      border: 1px solid var(--border-highlight);
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.3px;
    }

    /* ── Strategy / How to Win card ── */
    .card-strategy {
      grid-column: span 12;
      padding: 32px;
      scroll-margin-top: 24px;
    }
    .strategy-list {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 32px;
      margin-top: 8px;
    }
    .strategy-item { position: relative; }
    .strat-num {
      font-family: var(--font-display);
      font-size: 48px;
      color: var(--border-highlight);
      line-height: 1;
      margin-bottom: 12px;
      opacity: 0.5;
      transition: color 0.2s, opacity 0.2s;
    }
    .strategy-item:hover .strat-num { color: var(--accent-cyan); opacity: 1; }
    .strat-head {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 8px;
      color: var(--text-main);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    .strat-desc { font-size: 14px; color: var(--text-muted); line-height: 1.6; }
    .strat-priority {
      display: inline-block;
      font-size: 9px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.8px;
      padding: 1px 5px;
      margin-bottom: 6px;
    }
    .strat-priority.high   { color: var(--accent-cyan); background: rgba(0,229,255,0.08); }
    .strat-priority.medium { color: var(--yellow);  background: rgba(251,191,36,0.08); }
    .strat-priority.low    { color: var(--text-muted); background: rgba(255,255,255,0.04); }

    /* ── Build Your Prompt card ── */
    .card-prompt {
      grid-column: span 12;
      padding: 32px;
      scroll-margin-top: 24px;
    }
    .prompt-block {
      background: var(--bg-deep);
      border: 1px solid var(--border);
      padding: 20px 24px;
      font-family: 'Courier New', Courier, monospace;
      font-size: 13px;
      line-height: 1.7;
      color: var(--text-muted);
      white-space: pre-wrap;
      margin-bottom: 16px;
      min-height: 120px;
    }
    .prompt-copy-btn {
      padding: 10px 24px;
      background: var(--accent-cyan);
      color: #000;
      border: none;
      font-family: var(--font-body);
      font-size: 13px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      cursor: pointer;
      transition: opacity 0.15s;
    }
    .prompt-copy-btn:hover { opacity: 0.85; }
    .prompt-copy-btn:disabled { opacity: 0.5; cursor: default; }

    /* Action row */
    .action-row {
      display: none;
      align-items: center;
      gap: 12px;
      padding-top: 24px;
      border-top: 1px solid var(--border);
      margin-top: 24px;
      flex-wrap: wrap;
    }
    .action-row.visible { display: flex; }
    .btn-secondary {
      padding: 10px 20px;
      background: transparent;
      border: 1px solid var(--border-highlight);
      color: var(--text-main);
      font-family: var(--font-body);
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.15s;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    .btn-secondary:hover { border-color: var(--text-muted); }
    .btn-accent {
      padding: 10px 20px;
      background: transparent;
      border: 1px solid rgba(0,229,255,0.3);
      color: var(--accent-cyan);
      font-family: var(--font-body);
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.15s;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    .btn-accent:hover { background: rgba(0,229,255,0.06); }

    /* Copy toast */
    .copy-feedback {
      position: fixed;
      bottom: 80px;
      right: 32px;
      background: var(--bg-card);
      border: 1px solid var(--border);
      padding: 10px 16px;
      font-size: 13px;
      color: var(--green);
      font-weight: 600;
      opacity: 0;
      transform: translateY(8px);
      transition: all 0.2s;
      pointer-events: none;
      z-index: 999;
    }
    .copy-feedback.show { opacity: 1; transform: translateY(0); }

    /* ── Responsive ── */
    #results-inner {
      display: flex;
      min-height: 100vh;
    }

    @media (max-width: 1024px) {
      .dashboard-grid { grid-template-columns: repeat(2, 1fr); }
      .card-score, .card-competitors, .card-community, .card-strategy, .card-prompt { grid-column: span 2; }
      .card-market, .card-audience, .card-build, .card-ship { grid-column: span 2; }
      .card-market { grid-template-columns: 120px 1fr; gap: 20px; }
      .pulse-grid { grid-template-columns: 1fr; }
      .comp-grid { grid-template-columns: repeat(2, 1fr); }
    }

    @media (max-width: 768px) {
      #results-inner { flex-direction: column; }
      .sidebar {
        width: 100%; height: auto;
        position: relative;
        flex-direction: row;
        overflow-x: auto;
        padding: 16px;
        border-right: none;
        border-bottom: 1px solid var(--border);
      }
      .brand-link { border-bottom: none; margin-bottom: 0; margin-right: 24px; white-space: nowrap; padding: 0 16px 0 0; }
      .nav-menu { flex-direction: row; }
      .nav-item { padding: 8px 16px; white-space: nowrap; border-left: none; border-bottom: 2px solid transparent; }
      .nav-item.active { border-left: none; border-bottom-color: var(--accent-cyan); background: none; }
      .main-view { padding: 16px; }
      .dashboard-grid { grid-template-columns: 1fr; gap: 16px; }
      .card-score, .card-market, .card-audience, .card-competitors,
      .card-build, .card-ship, .card-community, .card-strategy, .card-prompt { grid-column: span 1; }
      .card-score { grid-template-columns: 1fr; text-align: center; gap: 24px; }
      .score-stats { border-left: none; border-top: 1px solid var(--border); padding-left: 0; padding-top: 20px; }
      .comp-grid { grid-template-columns: 1fr; }
      .strategy-list { grid-template-columns: 1fr; }
      .pulse-grid { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>

<!-- ══════════════════════════════════════════════
     LANDING PAGE
══════════════════════════════════════════════ -->
<section id="landing">
  <div class="landing-inner">
    <h1 class="landing-h1">Is your idea<br>worth building?</h1>
    <p class="landing-sub">Stop guessing. Run your concept through our multi-vector validation engine to analyze market saturation, technical feasibility, and trend velocity.</p>

    <div class="form-card">
      <div class="mode-selector-row">

        <div class="mode-selector">
          <button class="mode-btn active" data-value="market" onclick="setMode(this)">
            Build to Market
            <span class="mode-sub">Viability, competitors, opportunity</span>
          </button>
          <button class="mode-btn" data-value="personal" onclick="setMode(this)">
            Build for Myself
            <span class="mode-sub">Do existing options cover my need?</span>
          </button>
        </div>
      </div>
      <label class="field-label" for="idea-input">Your idea.</label>
      <div class="textarea-wrapper">
        <textarea id="idea-input" placeholder="e.g. A mobile app that lets friends split restaurant bills by scanning the receipt with their camera..."></textarea>
      </div>
      <div class="skill-selector-row">

        <div class="skill-selector">
          <button class="skill-btn" data-value="first_project" onclick="setSkill(this)">First project</button>
          <button class="skill-btn active" data-value="done_a_few" onclick="setSkill(this)">A few projects</button>
          <button class="skill-btn" data-value="build_regularly" onclick="setSkill(this)">Building regularly</button>
        </div>
      </div>
      <button class="cta-button" id="analyze-btn" onclick="analyze()">Vibe Check</button>
    </div>
  </div>
</section>

<!-- ══════════════════════════════════════════════
     RESULTS PAGE
══════════════════════════════════════════════ -->
<button class="sidebar-toggle" id="sidebar-toggle" onclick="toggleSidebar()" aria-label="Toggle navigation">☰</button>
<div class="sidebar-overlay" id="sidebar-overlay" onclick="closeSidebar()"></div>

<section id="results">
  <div id="results-inner">

    <!-- Sidebar -->
    <nav class="sidebar">
      <a class="brand-link" onclick="goHome()">
        <span class="brand-mono">VC</span>
        <span class="brand-full">Vibe Check</span>
      </a>
      <ul class="nav-menu" id="results-nav">
        <li class="nav-item active" onclick="jumpTo('sec-score')"><span class="nav-label">Overview</span></li>
        <li class="nav-item" onclick="jumpTo('sec-market')"><span class="nav-label">Market Signal</span></li>
        <li class="nav-item" onclick="jumpTo('sec-competitors')"><span class="nav-label">Competitors</span></li>
        <li class="nav-item" onclick="jumpTo('sec-community')"><span class="nav-label">Community</span></li>
        <li class="nav-item" onclick="jumpTo('sec-strategy')"><span class="nav-label">How to Win</span></li>
        <li class="nav-item" onclick="jumpTo('sec-build')"><span class="nav-label">Build + Ship</span></li>
        <li class="nav-item" onclick="jumpTo('sec-prompt')"><span class="nav-label">Build Your Prompt</span></li>
      </ul>
    </nav>

    <!-- Main content -->
    <main class="main-view">

      <div class="results-header">
        <div class="results-idea-title" id="results-title">Analyzing your idea...</div>
      </div>

      <div class="status-bar" id="status-bar">
        <div class="status-dot"></div>
        <div class="status-text" id="status-text">Getting started...</div>
      </div>

      <div class="dashboard-grid">

        <!-- Score -->
        <div class="section-card card-score" id="sec-score">
          <div class="score-left">
            <div class="section-header">Vibe Check Result</div>
            <h2 id="score-headline">Analyzing...</h2>
            <p id="score-summary"></p>
          </div>
          <div class="score-visual">
            <div class="grade-ring">
              <div class="grade-value" id="grade-value">—</div>
            </div>
            <div class="score-meta" id="score-meta"></div>
          </div>
          <div class="score-stats" id="score-stats">
            <div class="skel-block skeleton" style="height:60px"></div>
            <div class="skel-block skeleton" style="height:60px"></div>
            <div class="skel-block skeleton" style="height:60px"></div>
          </div>
        </div>

        <!-- Market -->
        <div class="section-card card-market" id="sec-market">
          <div class="market-visual-col" id="market-visual">
            <div class="market-status-label" id="market-condition">—</div>
            <div class="market-status-sub">Market Status</div>
            <div class="sat-meter" id="sat-meter">
              <div class="sat-meter-fill" id="sat-meter-fill" style="height:0%"></div>
            </div>
            <div class="sat-score-row">
              <span class="sat-score-num" id="sat-score-num">—</span>
              <span class="sat-score-denom">/10</span>
            </div>
            <div class="sat-score-label">Saturation</div>
          </div>
          <div class="market-data-col" id="market-data">
            <div class="data-point skeleton" style="height:60px"></div>
            <div class="data-point skeleton" style="height:60px"></div>
          </div>
        </div>

        <!-- Audience -->
        <div class="section-card card-audience" id="sec-audience">
          <div class="section-header">Target Audience</div>
          <div id="audience-body">
            <div class="skeleton skel-block" style="height:48px"></div>
            <div class="skeleton skel-block" style="height:48px"></div>
            <div class="skeleton skel-block" style="height:48px"></div>
          </div>
        </div>

        <!-- Competitors -->
        <div class="section-card card-competitors" id="sec-competitors">
          <div class="section-header">
            Competitive Landscape
            <span class="section-badge" id="comp-count"></span>
          </div>
          <div class="comp-grid" id="comp-grid">
            <div class="comp-tile skeleton" style="height:120px"></div>
            <div class="comp-tile skeleton" style="height:120px"></div>
            <div class="comp-tile skeleton" style="height:120px"></div>
            <div class="comp-tile skeleton" style="height:120px"></div>
          </div>
        </div>

        <!-- Build It -->
        <div class="section-card card-build" id="sec-build">
          <div class="section-header">
            Build Velocity
            <span class="section-badge" id="diff-badge"></span>
          </div>
          <div id="build-body">
            <div class="skeleton skel-block" style="height:80px"></div>
            <div class="skeleton skel-block" style="height:40px"></div>
          </div>
        </div>

        <!-- Ship It -->
        <div class="section-card card-ship" id="sec-ship">
          <div class="section-header">
            Ship It
            <span class="section-badge" id="ship-badge"></span>
          </div>
          <div id="ship-body">
            <div class="skeleton skel-block" style="height:40px"></div>
            <div class="skeleton skel-block" style="height:40px"></div>
            <div class="skeleton skel-block" style="height:40px"></div>
          </div>
        </div>

        <!-- Community Pulse -->
        <div class="section-card card-community" id="sec-community">
          <div class="section-header">Community Pulse</div>
          <div class="pulse-grid" id="pulse-grid">
            <div>
              <div class="pulse-col-header pain">Pain Points</div>
              <div class="pulse-items" id="pulse-pain">
                <div class="skeleton skel-block" style="height:80px"></div>
              </div>
            </div>
            <div>
              <div class="pulse-col-header love">What People Love</div>
              <div class="pulse-items" id="pulse-love">
                <div class="skeleton skel-block" style="height:80px"></div>
              </div>
            </div>
            <div>
              <div class="pulse-col-header wish">Wish List</div>
              <div class="pulse-items" id="pulse-wish">
                <div class="skeleton skel-block" style="height:80px"></div>
              </div>
            </div>
          </div>
        </div>

        <!-- How to Win -->
        <div class="section-card card-strategy" id="sec-strategy">
          <div class="section-header">How to Win</div>
          <div class="strategy-list" id="strategy-list">
            <div class="skeleton skel-block" style="height:100px"></div>
            <div class="skeleton skel-block" style="height:100px"></div>
            <div class="skeleton skel-block" style="height:100px"></div>
          </div>
        </div>

        <!-- Build Your Prompt -->
        <div class="section-card card-prompt" id="sec-prompt">
          <div class="section-header">
            Build Your Prompt
            <span class="section-badge">Claude Code Ready</span>
          </div>
          <p style="font-size:13px;color:var(--text-muted);margin-bottom:16px;line-height:1.6">Copy this prompt into Claude Code, Cursor, or any AI coding assistant to start building your validated idea.</p>
          <div class="prompt-block" id="prompt-block">
            <div class="skeleton skel-block" style="height:160px"></div>
          </div>
          <button class="prompt-copy-btn" id="prompt-copy-btn" onclick="copyPrompt()">Copy Prompt</button>
        </div>

      </div><!-- /dashboard-grid -->

      <div class="action-row" id="action-row">
        <button class="btn-secondary" onclick="goHome()">New Analysis</button>
        <button class="btn-accent" onclick="shareResult()">Share Result</button>
      </div>

    </main>
  </div>
</section>

<!-- Version corner (always visible) -->
<div class="version-corner">
  <span class="version-badge" onclick="toggleChangelog(event)">v1.7</span>
  <div class="changelog-popover" id="changelog-popover">
    <div class="changelog-header">Release Notes</div>
    <div class="changelog-entry">
      <div class="changelog-version">v1.7 <span class="changelog-date">— Feb 24, 2026</span></div>
      <ul class="changelog-list">
        <li>Mode toggle: Build to Market vs Build for Myself</li>
        <li>Personal mode: gap analysis against existing alternatives</li>
        <li>Build-or-use verdict replaces opportunity grade in personal mode</li>
        <li>Personal mode hides monetization, relabels nav and sections</li>
        <li>Skill level selector — Your idea. / Experience. labels</li>
      </ul>
    </div>
    <div class="changelog-entry">
      <div class="changelog-version">v1.6 <span class="changelog-date">— Feb 20, 2026</span></div>
      <ul class="changelog-list">
        <li>New high-design landing and output pages with cyan color scheme</li>
        <li>Merged landing and output into single app</li>
        <li>Collapsible sidebar — VC monogram when collapsed, full nav on hover</li>
        <li>Market Signal: vertical saturation meter, no duplicate data</li>
        <li>Community Pulse: up to 6 insights targeting named competitors</li>
        <li>New Build Your Prompt card with one-click copy</li>
        <li>Competitor names hyperlinked, cleaner competitor tiles</li>
        <li>Added Ship It, monetization strategies, How to Win from live data</li>
        <li>Font sizes increased across output page</li>
      </ul>
    </div>
  </div>
</div>

<!-- Copy toast -->
<div class="copy-feedback" id="copy-feedback">Link copied!</div>

<script>
  // ── STATE ──────────────────────────────────────
  let currentResultId      = null;
  let navObserver          = null;
  let _selectedSkillLevel  = 'done_a_few';
  let _selectedMode        = 'market';
  let _cachedMode          = 'market';
  let _cachedIdea   = '';
  let _cachedOpp    = null;
  let _cachedTech   = null;
  let _cachedDeploy = null;

  function setSkill(btn) {
    document.querySelectorAll('.skill-btn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    _selectedSkillLevel = btn.dataset.value;
  }

  function setMode(btn) {
    document.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    _selectedMode = btn.dataset.value;
  }

  function applyModeLabels(mode) {
    const p = mode === 'personal';

    // Sidebar nav labels
    const nav = document.querySelectorAll('#results-nav .nav-label');
    if (nav[1]) nav[1].textContent = p ? 'What Exists'  : 'Market Signal';
    if (nav[2]) nav[2].textContent = p ? 'Alternatives' : 'Competitors';
    if (nav[4]) nav[4].textContent = p ? 'Why Build It' : 'How to Win';

    // Section headers (use textContent carefully to preserve badge child nodes)
    const scoreHeader = document.querySelector('#sec-score .section-header');
    if (scoreHeader) scoreHeader.textContent = p ? 'Build or Use?' : 'Vibe Check Result';

    const compHeader = document.querySelector('#sec-competitors .section-header');
    if (compHeader && compHeader.childNodes[0]) {
      compHeader.childNodes[0].nodeValue = p ? 'Alternatives ' : 'Competitive Landscape ';
    }

    const stratHeader = document.querySelector('#sec-strategy .section-header');
    if (stratHeader) stratHeader.textContent = p ? 'Why Build It' : 'How to Win';

    // Saturation meter label
    const satLabel = document.querySelector('.sat-score-label');
    if (satLabel) satLabel.textContent = p ? 'Coverage' : 'Saturation';

    // Grade ring hint (only in personal mode)
    const existing = document.getElementById('grade-hint');
    if (p && !existing) {
      const hint = document.createElement('div');
      hint.id = 'grade-hint';
      hint.style.cssText = 'font-size:11px;color:var(--text-muted);text-align:center;margin-top:6px;letter-spacing:0.5px';
      hint.textContent = 'A\u2013C  Build It  \u00b7  D\u2013F  Use What Exists';
      const scoreMeta = document.getElementById('score-meta');
      if (scoreMeta) scoreMeta.insertAdjacentElement('afterend', hint);
    } else if (!p && existing) {
      existing.remove();
    }
  }

  function _tryRenderPrompt() {
    if (_cachedIdea && _cachedOpp && _cachedTech && _cachedDeploy) {
      renderPrompt(_cachedIdea, _cachedOpp, _cachedTech, _cachedDeploy);
    }
  }

  // ── NAV & ROUTING ─────────────────────────────
  function goHome() {
    if (navObserver) navObserver.disconnect();
    currentResultId = null;
    history.replaceState(null, '', '/');
    document.getElementById('results').style.display = 'none';
    document.getElementById('landing').style.display = 'flex';
    window.scrollTo(0, 0);
    // Reset mode to market default
    _cachedMode = 'market';
    _selectedMode = 'market';
    applyModeLabels('market');
    document.querySelectorAll('.mode-btn').forEach(b => b.classList.toggle('active', b.dataset.value === 'market'));
  }

  function jumpTo(id) {
    document.getElementById(id)?.scrollIntoView({ behavior: 'smooth', block: 'start' });
  }

  function setupNavObserver() {
    if (navObserver) navObserver.disconnect();
    const sections = ['sec-score','sec-market','sec-competitors','sec-community','sec-strategy','sec-build','sec-ship','sec-prompt'];
    const navItems = document.querySelectorAll('.nav-item');
    navObserver = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          const idx = sections.indexOf(entry.target.id);
          navItems.forEach((item, i) => item.classList.toggle('active', i === idx));
        }
      });
    }, { rootMargin: '-15% 0px -70% 0px', threshold: 0 });
    sections.forEach(id => { const el = document.getElementById(id); if (el) navObserver.observe(el); });
  }

  // ── HELPERS ───────────────────────────────────
  function humanize(str) {
    return (str || '').replace(/_/g, ' ').replace(/\b\w/g, c => c.toUpperCase());
  }

  function gradeColor(g) {
    return { A: 'value-green', B: 'value-cyan', C: 'value-yellow', D: 'value-red', F: 'value-red' }[g] || '';
  }

  function recClass(r) {
    const m = { highly_recommended: 'rec-green', recommended: 'rec-cyan', possible: 'rec-yellow', not_recommended: 'rec-red' };
    return m[r] || 'rec-yellow';
  }

  function diffColor(d) {
    const m = { no_code: 'value-green', beginner: 'value-green', intermediate: 'value-yellow', advanced: 'value-red', expert: 'value-red' };
    return m[d] || '';
  }

  // ── RENDERERS ─────────────────────────────────

  function renderScore(opp) {
    const g = opp.opportunity_grade || '?';
    document.getElementById('grade-value').textContent = g;
    document.getElementById('grade-value').className = 'grade-value ' + gradeColor(g);
    document.getElementById('score-meta').textContent = humanize(opp.opportunity_type || '');
    document.getElementById('score-headline').textContent = humanize(opp.trend || '') + ' Market';
    document.getElementById('score-summary').textContent = opp.opportunity_summary || '';

    document.getElementById('score-stats').innerHTML = `
      <div class="stat-row">
        <label>Opportunity Score</label>
        <div class="value">${opp.opportunity_score || '—'}<span style="font-size:16px;color:var(--text-muted)">/10</span></div>
      </div>
      <div class="stat-row">
        <label>Market Size</label>
        <div class="value" style="font-size:16px;line-height:1.4">${opp.market_size || '—'}</div>
      </div>
      <div class="stat-row">
        <label>Trend</label>
        <div class="value ${gradeColor(g)}">${humanize(opp.trend || '')}</div>
      </div>
    `;
  }

  function renderMarket(d) {
    const sat = d.saturation_score || 0;
    const existsLabel = humanize(d.exists || '');

    // Left column: vertical meter
    document.getElementById('market-condition').textContent = existsLabel;
    document.getElementById('sat-score-num').textContent = sat;
    // Animate fill height after a short delay so transition plays
    setTimeout(() => {
      const fill = document.getElementById('sat-meter-fill');
      if (fill) fill.style.height = (sat * 10) + '%';
    }, 100);

    // Right column: differentiators + consolidated summary (no Market Status repeat)
    const diffs = (d.key_differentiators_needed || []).map(k => `<span class="diff-tag">${k}</span>`).join('');
    document.getElementById('market-data').innerHTML = `
      <div class="data-point">
        <p style="font-size:15px;color:var(--text-main);line-height:1.6;margin-bottom:12px">${d.market_summary || ''}</p>
        ${diffs ? `<p style="margin-bottom:6px;font-size:11px;text-transform:uppercase;letter-spacing:0.5px;color:var(--text-muted)">Differentiators Needed</p>
        <div class="diff-tags">${diffs}</div>` : ''}
      </div>
    `;
  }

  function renderAudience(opp) {
    const segments = (opp.target_audiences || []).slice(0, 4);
    const segsHTML = segments.map((a, i) => `
      <div class="segment-block ${i === 0 ? 'primary' : ''}">
        <span class="segment-name">${a.segment || ''}</span>
        <span class="segment-val">${humanize(a.size || '')} · ${humanize(a.willingness_to_pay || '')} WTP</span>
      </div>
    `).join('');

    const monos = _cachedMode !== 'personal' ? (opp.monetization_strategies || []).slice(0, 2) : [];
    const monoHTML = monos.length ? `
      <div class="mono-row">
        <div class="section-header" style="margin-bottom:8px">Monetization</div>
        ${monos.map(m => `
          <div class="mono-item">
            <div class="mono-model">${m.model || ''}</div>
            <div class="mono-potential">${m.revenue_potential || ''}</div>
          </div>
        `).join('')}
      </div>
    ` : '';

    document.getElementById('audience-body').innerHTML = segsHTML + monoHTML;
  }

  function renderCompetitors(d) {
    const comps = d.competitors || [];
    document.getElementById('comp-count').textContent = comps.length ? `${comps.length} found` : '';
    if (!comps.length) {
      document.getElementById('comp-grid').innerHTML = '<p style="color:var(--text-muted);font-size:13px;padding:16px 0">No competitors identified.</p>';
      return;
    }
    // Dynamic column count based on number of competitors
    const cols = Math.min(comps.length, 4);
    const grid = document.getElementById('comp-grid');
    grid.style.gridTemplateColumns = `repeat(${cols}, 1fr)`;
    grid.innerHTML = comps.map((c, i) => {
      const strengths = (c.strengths || []).slice(0, 2).map(s => `<span class="sw-tag sw-strength">${s}</span>`).join('');
      const weaknesses = (c.weaknesses || []).slice(0, 2).map(w => `<span class="sw-tag sw-weakness">${w}</span>`).join('');
      const nameEl = c.url
        ? `<a class="comp-name" href="${c.url.startsWith('http') ? c.url : 'https://'+c.url}" target="_blank" rel="noopener">${c.name || ''}</a>`
        : `<div class="comp-name">${c.name || ''}</div>`;
      return `
        <div class="comp-tile">
          ${nameEl}
          ${c.description ? `<div class="comp-desc">${c.description}</div>` : ''}
          <div class="comp-meta">
            <span>Market Share</span>
            <span>${c.pricing || '—'}</span>
          </div>
          <div class="strength-bar"><div class="strength-fill" style="width:${70 - i * 12}%"></div></div>
          <div class="sw-row">${strengths}${weaknesses}</div>
        </div>
      `;
    }).join('');
  }

  function renderBuild(d) {
    const diff = humanize(d.difficulty || '');
    document.getElementById('diff-badge').textContent = diff;
    document.getElementById('diff-badge').className = 'section-badge ' + diffColor(d.difficulty);

    const timeEst = d.time_estimates?.[_selectedSkillLevel] || d.time_estimates?.done_a_few || d.time_estimates?.first_project || 'Varies';
    const stack = d.tech_stack || {};
    const apis  = d.required_apis || [];

    const stackBadges = Object.entries(stack).filter(([,v]) => v).map(([k, v]) => `<div class="tech-badge" title="${k}">${v}</div>`).join('');
    const apiList = apis.slice(0, 4).map(a => `
      <div style="display:flex;justify-content:space-between;align-items:center;padding:6px 0;border-bottom:1px solid var(--border)">
        <span style="font-size:12px;color:var(--text-main)">${a.url ? `<a href="${a.url}" target="_blank" rel="noopener" style="color:var(--accent-cyan);text-decoration:none">${a.name}</a>` : a.name}</span>
        <span style="font-size:11px;color:var(--text-muted)">${a.cost || ''}</span>
      </div>
    `).join('');

    document.getElementById('build-body').innerHTML = `
      <div class="time-lockup">
        <span>Est. Time to MVP</span>
        ${timeEst}
      </div>
      <p class="build-summary">${d.technical_summary || ''}</p>
      ${stackBadges ? `<div style="font-size:11px;text-transform:uppercase;letter-spacing:0.5px;color:var(--text-muted);margin-bottom:8px">Recommended Stack</div><div class="tech-stack">${stackBadges}</div>` : ''}
      ${apiList ? `<div style="margin-top:16px"><div style="font-size:11px;text-transform:uppercase;letter-spacing:0.5px;color:var(--text-muted);margin-bottom:8px">Key APIs</div>${apiList}</div>` : ''}
    `;
  }

  function renderDeploy(d) {
    const rec = humanize(d.primary_recommendation || '');
    document.getElementById('ship-badge').textContent = rec;

    const options = (d.deployment_options || []).slice(0, 4);
    document.getElementById('ship-body').innerHTML = `
      ${d.quick_win_approach ? `<p style="font-size:13px;color:var(--text-muted);line-height:1.6;margin-bottom:12px">${d.quick_win_approach}</p>` : ''}
      <div class="deploy-list">
        ${options.map(o => `
          <div class="deploy-item">
            <div>
              <div class="deploy-platform">${o.platform || ''}</div>
              ${o.reasoning ? `<div class="deploy-reason">${o.reasoning}</div>` : ''}
            </div>
            <div style="display:flex;flex-direction:column;align-items:flex-end;gap:4px;flex-shrink:0;margin-left:12px">
              <span class="rec-pill ${recClass(o.recommendation_level)}">${humanize(o.recommendation_level || '')}</span>
              ${o.time_to_market ? `<span class="deploy-time">${o.time_to_market}</span>` : ''}
            </div>
          </div>
        `).join('')}
      </div>
    `;
  }

  function renderSentiment(d) {
    const insights = d.community_insights || [];
    const pain = insights.filter(i => i.sentiment === 'pain_point').slice(0, 2);
    const love = insights.filter(i => i.sentiment === 'loved_feature').slice(0, 2);
    const wish = insights.filter(i => i.sentiment === 'wish').slice(0, 2);

    function renderItems(items, cls) {
      if (!items.length) return '<p style="font-size:12px;color:var(--text-muted);padding:8px 0">No data found.</p>';
      return items.map(s => {
        const sourceLink = s.source_url
          ? `<a href="${s.source_url}" target="_blank" rel="noopener">${s.source || 'Source'}</a>`
          : (s.source || '');
        const compBadge = s.competitor_reference
          ? `<span class="pulse-competitor">re: ${s.competitor_reference}</span>`
          : `<span class="pulse-competitor" style="opacity:0.5">general space</span>`;
        return `
          <div class="pulse-item ${cls}">
            <div class="pulse-quote">"${s.quote || ''}"</div>
            <div class="pulse-meta">
              <span class="pulse-theme">${s.theme || ''}</span>
              <span class="pulse-source">${sourceLink}</span>
              ${compBadge}
            </div>
          </div>
        `;
      }).join('');
    }

    document.getElementById('pulse-pain').innerHTML = renderItems(pain, 'pain');
    document.getElementById('pulse-love').innerHTML = renderItems(love, 'love');
    document.getElementById('pulse-wish').innerHTML = renderItems(wish, 'wish');
  }

  function renderStrategy(opp) {
    const suggestions = (opp.improvement_suggestions || []).slice(0, 6);
    if (!suggestions.length) {
      document.getElementById('strategy-list').innerHTML = '<p style="color:var(--text-muted);font-size:13px">No strategy data available.</p>';
      return;
    }
    // Up to 6 items in a 3-col grid
    const cols = Math.min(suggestions.length, 3);
    document.getElementById('strategy-list').style.gridTemplateColumns = `repeat(${cols}, 1fr)`;
    document.getElementById('strategy-list').innerHTML = suggestions.map((s, i) => `
      <div class="strategy-item">
        <div class="strat-num">0${i + 1}</div>
        <div class="strat-priority ${s.priority || 'medium'}">${(s.priority || '').toUpperCase()}</div>
        <div class="strat-head">${s.suggestion || ''}</div>
        <div class="strat-desc">${s.reasoning || ''}</div>
      </div>
    `).join('');
  }

  // ── BUILD YOUR PROMPT ─────────────────────────
  let _promptText = '';

  function renderPrompt(idea, opp, tech, deploy) {
    const audience = (opp.target_audiences || [])[0];
    const differentiator = (opp.improvement_suggestions || [])[0];
    const stack = tech.tech_stack || {};
    const stackSummary = [stack.frontend, stack.backend, stack.database, stack.hosting].filter(Boolean).join(', ');
    const platform = deploy.primary_recommendation ? deploy.primary_recommendation.replace(/_/g, ' ') : 'web app';
    const audienceLine = audience ? `- Primary audience: ${audience.segment} (${audience.size} market, ${audience.willingness_to_pay} willingness to pay)` : '';
    const diffLine = differentiator ? `- Key differentiator to build toward: ${differentiator.suggestion}` : '';
    const stackLine = stackSummary ? `- Recommended stack: ${stackSummary}` : '';

    const isPersonal = _cachedMode === 'personal';
    const promptIntro   = isPersonal ? `Build ${idea} for personal use.`      : `Build a ${idea}.`;
    const promptContext = isPersonal ? `Context from research on existing alternatives:` : `Context from market research:`;
    const promptClosing = isPersonal
      ? `Start with the core feature that existing tools get wrong. Keep scope minimal — only what you actually need for yourself. Skip multi-user support, billing, and onboarding unless asked. Ask me before adding anything beyond the core scope.`
      : `Start by setting up the project structure, then implement the core user flow end-to-end. Keep the MVP tight — focus on the single most important feature that addresses the primary audience's top pain point. Ask me before adding anything beyond the core scope.`;

    _promptText = `${promptIntro}

${promptContext}
${audienceLine}
${diffLine}
${stackLine}
- Deploy as: ${platform}
- Est. time to MVP: ${tech.time_estimates?.[_selectedSkillLevel] || tech.time_estimates?.done_a_few || 'a few weeks'}

${promptClosing}`.trim();

    const block = document.getElementById('prompt-block');
    if (block) block.textContent = _promptText;
    const btn = document.getElementById('prompt-copy-btn');
    if (btn) btn.disabled = false;
  }

  function copyPrompt() {
    if (!_promptText) return;
    navigator.clipboard.writeText(_promptText).then(() => {
      const btn = document.getElementById('prompt-copy-btn');
      if (btn) { btn.textContent = 'Copied!'; setTimeout(() => { btn.textContent = 'Copy Prompt'; }, 2000); }
    });
  }

  // ── ANALYZE ───────────────────────────────────
  async function analyze() {
    const idea = document.getElementById('idea-input').value.trim();
    if (!idea) { alert('Please describe your idea first.'); return; }

    document.getElementById('landing').style.display = 'none';
    document.getElementById('results').style.display = 'block';
    document.getElementById('results-title').textContent = 'Analyzing your idea...';
    document.getElementById('status-bar').style.display = 'flex';
    document.getElementById('action-row').classList.remove('visible');
    document.getElementById('analyze-btn').disabled = true;

    _cachedMode = _selectedMode;
    applyModeLabels(_selectedMode);
    resetSkeletons();
    setupNavObserver();
    window.scrollTo(0, 0);
    currentResultId = null;
    _cachedIdea = idea;
    _cachedOpp = null;
    _cachedTech = null;
    _cachedDeploy = null;

    try {
      const response = await fetch('/api/analyze', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ idea, skillLevel: _selectedSkillLevel, mode: _selectedMode }),
      });

      const reader  = response.body.getReader();
      const decoder = new TextDecoder();
      let buffer = '';

      while (true) {
        const { done, value } = await reader.read();
        if (done) break;
        buffer += decoder.decode(value, { stream: true });
        const parts = buffer.split('\n\n');
        buffer = parts.pop();
        for (const part of parts) {
          const lines = part.split('\n');
          let event = '', data = '';
          for (const line of lines) {
            if (line.startsWith('event: ')) event = line.slice(7);
            if (line.startsWith('data: '))  data  = line.slice(6);
          }
          if (!event || !data) continue;
          try { handleEvent(event, JSON.parse(data), idea); } catch {}
        }
      }
    } catch (err) {
      document.getElementById('status-text').textContent = 'Error: ' + err.message;
    } finally {
      document.getElementById('analyze-btn').disabled = false;
    }
  }

  function handleEvent(event, data, idea) {
    switch (event) {
      case 'status':
        document.getElementById('status-text').textContent = data.message || '';
        break;
      case 'market':
        renderMarket(data);
        renderCompetitors(data);
        break;
      case 'technical':
        _cachedTech = data;
        renderBuild(data);
        _tryRenderPrompt();
        break;
      case 'opportunity':
        _cachedOpp = data;
        renderScore(data);
        renderAudience(data);
        renderStrategy(data);
        _tryRenderPrompt();
        break;
      case 'deployment':
        _cachedDeploy = data;
        renderDeploy(data);
        _tryRenderPrompt();
        break;
      case 'sentiment':
        renderSentiment(data);
        break;
      case 'complete':
        currentResultId = data.resultId;
        document.getElementById('status-bar').style.display = 'none';
        document.getElementById('results-title').textContent = idea;
        document.getElementById('action-row').classList.add('visible');
        if (data.resultId) history.replaceState(null, '', `?r=${data.resultId}`);
        break;
      case 'error':
        document.getElementById('status-text').textContent = 'Something went wrong: ' + (data.message || '');
        break;
    }
  }

  function resetSkeletons() {
    document.getElementById('grade-value').textContent = '—';
    document.getElementById('grade-value').className = 'grade-value';
    document.getElementById('score-meta').textContent = '';
    document.getElementById('score-headline').textContent = 'Analyzing...';
    document.getElementById('score-summary').textContent = '';
    document.getElementById('score-stats').innerHTML = `
      <div class="skel-block skeleton" style="height:60px"></div>
      <div class="skel-block skeleton" style="height:60px"></div>
      <div class="skel-block skeleton" style="height:60px"></div>
    `;
    document.getElementById('market-condition').textContent = '—';
    document.getElementById('sat-score-num').textContent = '—';
    const mf = document.getElementById('sat-meter-fill');
    if (mf) mf.style.height = '0%';
    document.getElementById('market-data').innerHTML = `
      <div class="data-point skeleton" style="height:80px"></div>
      <div class="data-point skeleton" style="height:40px"></div>
    `;
    document.getElementById('audience-body').innerHTML = `
      <div class="skeleton skel-block" style="height:48px"></div>
      <div class="skeleton skel-block" style="height:48px"></div>
      <div class="skeleton skel-block" style="height:48px"></div>
    `;
    document.getElementById('comp-grid').innerHTML = `
      <div class="comp-tile skeleton" style="height:120px"></div>
      <div class="comp-tile skeleton" style="height:120px"></div>
      <div class="comp-tile skeleton" style="height:120px"></div>
      <div class="comp-tile skeleton" style="height:120px"></div>
    `;
    document.getElementById('build-body').innerHTML = `
      <div class="skeleton skel-block" style="height:80px"></div>
      <div class="skeleton skel-block" style="height:40px"></div>
    `;
    document.getElementById('ship-body').innerHTML = `
      <div class="skeleton skel-block" style="height:40px"></div>
      <div class="skeleton skel-block" style="height:40px"></div>
      <div class="skeleton skel-block" style="height:40px"></div>
    `;
    document.getElementById('pulse-pain').innerHTML = '<div class="skeleton skel-block" style="height:80px"></div>';
    document.getElementById('pulse-love').innerHTML = '<div class="skeleton skel-block" style="height:80px"></div>';
    document.getElementById('pulse-wish').innerHTML = '<div class="skeleton skel-block" style="height:80px"></div>';
    document.getElementById('strategy-list').innerHTML = `
      <div class="skeleton skel-block" style="height:100px"></div>
      <div class="skeleton skel-block" style="height:100px"></div>
      <div class="skeleton skel-block" style="height:100px"></div>
    `;
    document.getElementById('diff-badge').textContent = '';
    document.getElementById('ship-badge').textContent = '';
    document.getElementById('comp-count').textContent = '';
    const pb = document.getElementById('prompt-block');
    if (pb) pb.innerHTML = '<div class="skeleton skel-block" style="height:160px"></div>';
    const cpb = document.getElementById('prompt-copy-btn');
    if (cpb) cpb.disabled = true;
  }

  // ── SHARE / LOAD ──────────────────────────────
  function shareResult() {
    navigator.clipboard.writeText(window.location.href).then(() => {
      const el = document.getElementById('copy-feedback');
      el.classList.add('show');
      setTimeout(() => el.classList.remove('show'), 2500);
    });
  }

  async function loadSharedResult(id) {
    document.getElementById('landing').style.display = 'none';
    document.getElementById('results').style.display = 'block';
    document.getElementById('status-text').textContent = 'Loading shared result...';
    window.scrollTo(0, 0);
    try {
      const r = await fetch(`/api/result/${id}`);
      if (!r.ok) throw new Error('Result not found or expired');
      const d = await r.json();
      _cachedMode = d.mode || 'market';
      applyModeLabels(_cachedMode);
      document.getElementById('results-title').textContent = d.idea;
      renderMarket(d.market);
      renderCompetitors(d.market);
      renderScore(d.opportunity);
      renderAudience(d.opportunity);
      renderStrategy(d.opportunity);
      renderBuild(d.technical);
      renderDeploy(d.deployment);
      renderSentiment(d.sentiment);
      renderPrompt(d.idea, d.opportunity, d.technical, d.deployment);
      document.getElementById('status-bar').style.display = 'none';
      document.getElementById('action-row').classList.add('visible');
      currentResultId = id;
      setupNavObserver();
    } catch (err) {
      document.getElementById('status-text').textContent = 'Error: ' + err.message;
    }
  }

  // ── SIDEBAR TOGGLE (MOBILE) ───────────────────
  function toggleSidebar() {
    const sidebar = document.querySelector('.sidebar');
    const overlay = document.getElementById('sidebar-overlay');
    sidebar.classList.toggle('open');
    overlay.classList.toggle('visible');
  }
  function closeSidebar() {
    document.querySelector('.sidebar').classList.remove('open');
    document.getElementById('sidebar-overlay').classList.remove('visible');
  }

  // ── VERSION POPOVER ───────────────────────────
  function toggleChangelog(e) {
    e.stopPropagation();
    document.getElementById('changelog-popover').classList.toggle('open');
  }
  document.addEventListener('click', () => {
    const p = document.getElementById('changelog-popover');
    if (p) p.classList.remove('open');
  });

  // ── INIT ──────────────────────────────────────
  (function init() {
    const rid = new URLSearchParams(window.location.search).get('r');
    if (rid) loadSharedResult(rid);
  })();
</script>
</body>
</html>
